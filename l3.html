[Download the updated HTML](sandbox:/mnt/data/l1-updated.html)

```html
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ledger ‚Äî Accounts & Chart (v2.6)</title>

<style>
/* ============================================
    GLOBAL / BASE
   ============================================ */
:root {
  --maxw: 1400px;
  --c-pos: #4c8036;
  --c-neg: #a02d2a;
  --c-bg: #ffffff;
  --c-fg: #000000;
  --c-border: #000000;
  --c-muted: #e8e8e8;
  --radius: 10px;
  --gap: 12px;

  /* inputs */
  --c-input-bg: #ffffff;
  --c-input-fg: #000000;
  --c-input-border: #000000;

  /* subtle tints */
  --c-tint-pos: #f7f9f4;
  --c-tint-neg: #f9f4f4;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--c-bg);
  color: var(--c-fg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}

.wrap { max-width: var(--maxw); margin: 0 auto; padding: 0 14px; }
.divider { border: none; border-top: 1px solid var(--c-border); margin: 14px 0; }
hr { border: none; border-top: 1px solid var(--c-border); margin: 12px 0; }

/* ============================================
    HEADER / TOOLBAR
   ============================================ */
header { padding: 12px 0 0; }
.toolbar {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
}

.financial-group { min-width: 240px; }
#financial-summary { font-weight: 700; }
#interest-summary { font-size: 0.9rem; opacity: 0.9; margin-top: 4px; }

.toolbar-right { display: flex; align-items: flex-start; gap: 10px; flex: 1 1 auto; justify-content: flex-end; min-width: 280px; }

.type-filter-row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

/* Buttons */
button {
  background: var(--c-bg);
  color: var(--c-fg);
  border: 1px solid var(--c-border);
  border-radius: 10px;
  padding: 10px 12px;
  font-weight: 650;
  cursor: pointer;
}
button:hover { filter: contrast(1.1); }
button:active { transform: translateY(1px); }

.toolbar-controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; justify-content: flex-end; }

.mobile-toggle-btn {
  display: none;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 12px;
}

/* Chart */
#chart { min-height: 340px; width: 100%; }
#chart-pager { display: flex; justify-content: center; gap: 8px; padding: 8px 0; }

/* ============================================
    VISUAL RATIO BAR
   ============================================ */
#visual-ratio-bar {
  width: 100%;
  display: flex;
  overflow: hidden;
  border: 1px solid var(--c-border);
  border-radius: 14px;
  height: 22px;
}
#ratio-asset { background: var(--c-pos); width: 50%; }
#ratio-debt  { background: var(--c-neg); width: 50%; }

.ratio-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 0.85rem;
  font-weight: 700;
}

/* ============================================
    MAIN LAYOUT
   ============================================ */
main { padding: 12px 0 24px; }
section.grid {
  display: grid;
  grid-template-columns: 1.2fr 0.8fr;
  gap: 14px;
}
.left, .right { border: 1px solid var(--c-border); border-radius: 14px; padding: 12px; }
.left h3, .right h3 { margin: 0 0 10px; }

.accounts { display: grid; gap: 10px; }

/* Account row */
.account {
  border: 1px solid var(--c-border);
  border-radius: 14px;
  padding: 10px;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  position: relative;
}
.account .name {
  font-weight: 800;
  margin-bottom: 6px;
}
.account .values {
  text-align: right;
  font-weight: 800;
}
.account .sub {
  font-size: 0.9rem;
  opacity: 0.92;
  margin-top: 2px;
}
.account-details { display: flex; gap: 10px; align-items: flex-start; }
.account-meta-stack { display: flex; flex-direction: column; gap: 4px; font-size: 0.85rem; opacity: 0.95; margin-top: 2px; }

/* Input line */
.input-line { display: flex; gap: 8px; align-items: center; margin-top: 8px; flex-wrap: wrap; }

/* Generic inputs */
input[type="number"], input[type="date"], input[type="text"], input[type="url"] {
  background: var(--c-input-bg);
  color: var(--c-input-fg);
  border: 1px solid var(--c-input-border);
  border-radius: 12px;
  padding: 10px 10px;
  font-weight: 700;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.value-input { transition: background-color 180ms ease-out; }

select {
  background: var(--c-bg);
  color: var(--c-fg);
  border: 1px solid var(--c-border);
  border-radius: 12px;
  padding: 10px 10px;
  font-weight: 700;
}

/* ============================================
    CONTROLS PANEL (right column)
   ============================================ */
.controls-wrap { display: grid; gap: 10px; }
.controls-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
.controls-row .label { font-weight: 800; }

.controls-h2 { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin: 0; }
.controls-h2 small { font-weight: 700; opacity: 0.85; }

.muted {
  opacity: 0.45;
  filter: grayscale(0.2);
}

.mute-checkbox { display: inline-flex; gap: 6px; align-items: center; font-weight: 800; cursor: pointer; user-select: none; }
.mute-checkbox input { transform: scale(1.1); }

/* ============================================
    BOTTOM CONTROLS
   ============================================ */
.bottom-controls-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin-top: 14px;
  flex-wrap: wrap;
}

#score-display { font-weight: 900; min-width: 40px; text-align: center; }
.score-label { font-size: 0.8rem; opacity: 0.85; font-weight: 800; margin-right: 6px; }

/* ============================================
    MODALS
   ============================================ */
.modal-backdrop {
  position: fixed; inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.55);
  z-index: 9999;
}
.modal {
  width: min(680px, 92vw);
  background: var(--c-bg);
  color: var(--c-fg);
  border: 1px solid var(--c-border);
  border-radius: 16px;
  padding: 14px;
}
.modal h3 { margin: 0 0 10px; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap; margin-top: 10px; }
.modal-form-group { display: grid; gap: 6px; margin: 10px 0; }
.modal-form-group label { font-weight: 800; }
.modal small { opacity: 0.85; }

/* ============================================
    TOAST
   ============================================ */
#toast {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 18px;
  background: var(--c-bg);
  color: var(--c-fg);
  border: 1px solid var(--c-border);
  border-radius: 14px;
  padding: 10px 12px;
  font-weight: 800;
  z-index: 99999;
  display: none;
}

/* ============================================
    MOBILE
   ============================================ */
@media (max-width: 640px) {
  section.grid { grid-template-columns: 1fr; }
  .toolbar-right { width: 100%; justify-content: flex-start; }
  .toolbar-controls { display: none; }
  .type-filter-row { display: none; }

  .mobile-toggle-btn { display: inline-flex; width: 100%; }

  #chart { min-height: 280px; }
}
</style>
</head>

<body>

<!-- Delete entry modal -->
<div id="delete-modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="delete-title">
  <div class="modal">
    <h3 id="delete-title">Delete Entry?</h3>
    <div>Do you really want to delete this entry?</div>
    <div class="modal-actions">
      <button id="delete-cancel">Cancel</button>
      <button id="delete-confirm">Yes, Delete</button>
    </div>
  </div>
</div>

<!-- Edit entry modal -->
<div id="edit-modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="edit-title">
  <div class="modal">
    <h3 id="edit-title">Edit Entry</h3>
    <div class="modal-form-group">
      <label for="edit-value">Value:</label>
      <input id="edit-value" type="number" step="0.01" />
    </div>
    <div class="modal-form-group">
      <label for="edit-date">Date:</label>
      <input id="edit-date" type="date" />
    </div>
    <div class="modal-actions">
      <button id="edit-delete">Delete</button>
      <button id="edit-cancel">Cancel</button>
      <button id="edit-save">Save</button>
    </div>
  </div>
</div>

<!-- Account actions modal -->
<div id="account-actions-modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="acct-actions-title">
  <div class="modal">
    <h3 id="acct-actions-title">Account Actions</h3>
    <div class="modal-actions" style="justify-content:flex-start;">
      <button id="acct-edit-btn">‚úèÔ∏è Edit Account Settings</button>
      <button id="acct-delete-btn">üóëÔ∏è Delete Account</button>
      <button id="acct-add-below-btn">‚ûï Add New Account Below</button>
      <button id="acct-actions-cancel-btn">Cancel</button>
    </div>
  </div>
</div>

<!-- Edit account modal -->
<div id="edit-account-modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="edit-account-title">
  <div class="modal">
    <h3 id="edit-account-title">Edit Account</h3>

    <div class="modal-form-group">
      <label for="edit-account-type">Type:</label>
      <select id="edit-account-type">
        <option value="Banks">Banks</option>
        <option value="CreditCards">CreditCards</option>
        <option value="Bills">Bills</option>
        <option value="Investments">Investments</option>
        <option value="Savings">Savings</option>
      </select>
    </div>

    <div class="modal-form-group">
      <label for="edit-account-color">Account Color (hex):</label>
      <input id="edit-account-color" type="text" placeholder="#4c8036" />
    </div>

    <div class="modal-form-group">
      <label for="edit-account-link">Account Link (login URL, etc.):</label>
      <input id="edit-account-link" type="url" placeholder="https://..." />
    </div>

    <div class="modal-form-group">
      <label for="edit-account-limit">Credit Limit (for CC accounts):</label>
      <input id="edit-account-limit" type="number" step="0.01" />
    </div>

    <div class="modal-form-group">
      <label for="edit-account-apr">APR (as decimal, e.g. 0.29 for 29%):</label>
      <input id="edit-account-apr" type="number" step="0.0001" />
    </div>

    <div class="modal-form-group">
      <label for="edit-account-current">Current Value:</label>
      <input id="edit-account-current" type="number" step="0.01" />
      <small>(Optional) This is informational for the settings modal; your actual values come from entries.</small>
    </div>

    <div class="modal-actions">
      <button id="edit-account-cancel">Cancel</button>
      <button id="edit-account-save">Save Changes</button>
    </div>
  </div>
</div>

<!-- Edit type color modal -->
<div id="edit-type-modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="edit-type-title">
  <div class="modal">
    <h3 id="edit-type-title">Edit Type Color</h3>
    <div class="modal-form-group">
      <label for="edit-type-color">Type Color (hex):</label>
      <input id="edit-type-color" type="text" placeholder="#4c8036" />
    </div>
    <div class="modal-actions">
      <button id="edit-type-cancel">Cancel</button>
      <button id="edit-type-save">Save</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<!-- Main header -->
<header>
  <div class="toolbar">
    <div class="financial-group">
      <div id="financial-summary"></div>
      <div id="interest-summary"></div>
    </div>

    <button id="mobile-toggle-btn" class="mobile-toggle-btn" aria-label="Toggle Controls">
      <span>‚ö° Controls & Filters</span>
      <span id="toggle-icon">‚ñº</span>
    </button>

    <div class="toolbar-right">
      <div id="typeFilterRow" class="type-filter-row"></div>

      <div class="toolbar-controls">
        <div class="controls-row">
          <span class="label">Timeframe:</span>
          <select id="timeframe">
            <option value="3d">Last 3 Days</option>
            <option value="today">Today</option>
            <option value="7d">Last 7 Days</option>
            <option value="14d">Last 14 Days</option>
            <option value="30d">Last 30 Days</option>
            <option value="90d">Last 90 Days</option>
            <option value="12mo">Last Year (12mo)</option>
            <option value="ytd">This Calendar Year</option>
            <option value="all">All Time</option>
          </select>
        </div>

        <div class="controls-row">
          <select id="mode">
            <option value="totals">Totals</option>
            <option value="type">Type</option>
            <option value="accounts">Per-account</option>
          </select>
          <button id="refresh" aria-label="Refresh data">Refresh</button>
          <button id="submitAll">Submit All</button>
        </div>
      </div>
    </div>
  </div>

  <hr>
  <div id="chart"></div>
  <div id="chart-pager" aria-label="Chart view navigation"></div>
  <hr>

  <!-- Visual Ratio Bar (Asset vs Debt) -->
  <div id="visual-ratio-bar">
    <div id="ratio-asset"></div>
    <div id="ratio-debt"></div>
  </div>
</header>

<hr class="wrap divider">

<main class="wrap">
  <section class="grid">
    <section class="left">
      <h3>Accounts</h3>
      <div id="accounts" class="accounts"></div>
    </section>

    <section class="right">
      <h3 class="controls-h2">
        <span>Controls</span>
        <small id="controls-subtitle"></small>
      </h3>

      <div id="controls" class="controls-wrap">
        <div class="controls-row">
          <span class="label">Timeframe:</span>
          <select id="timeframe2">
            <option value="3d">Last 3 Days</option>
            <option value="today">Today</option>
            <option value="7d">Last 7 Days</option>
            <option value="14d">Last 14 Days</option>
            <option value="30d">Last 30 Days</option>
            <option value="90d">Last 90 Days</option>
            <option value="12mo">Last Year (12mo)</option>
            <option value="ytd">This Calendar Year</option>
            <option value="all">All Time</option>
          </select>
        </div>

        <div class="controls-row">
          <span class="label">Mode:</span>
          <select id="mode2">
            <option value="totals">Totals</option>
            <option value="type">Type</option>
            <option value="accounts">Per-account</option>
          </select>
        </div>

        <div class="controls-row">
          <button id="refresh2">Refresh</button>
          <button id="submitAll2">Submit All</button>
        </div>

        <div class="controls-row" id="type-summary"></div>
      </div>
    </section>
  </section>

  <div class="bottom-controls-container">
    <button id="font-prev">&lt;</button>
    <button id="font-toggle">‚óê</button>
    <button id="font-next">&gt;</button>
    <span class="score-label">score</span><span id="score-display">0</span>
  </div>
</main>

<footer class="wrap" style="padding-bottom: 26px; opacity:0.9;">
  <div style="margin-top:10px;">
    Privacy First: No login credentials or personally identifiable information is stored in this application. All data resides in your Google Sheet. Your financial footprint, your control.
  </div>
  <div style="margin-top:6px;">
    v2.6 Features: CC limits ‚Ä¢ Edit account settings ‚Ä¢ Type summaries ‚Ä¢ Font Switcher ‚Ä¢ Mute/unmute ‚Ä¢ Dark mode ‚Ä¢ Score tracker ‚Ä¢ AccountMeta persistence
  </div>
  <div style="margin-top:10px;">
    <a href="https://docs.google.com" target="_blank" rel="noopener">Open Google Sheet</a>
  </div>
</footer>

<script>
/* ============================================
    CONFIGURATION
   ============================================ */
const API_BASE = 'https://script.google.com/macros/s/AKfycbyPG7SSqScuBLluk8cT7P0VV_y87XHPc97neA2NODRJlxzEbiwYnEZjNH71QaHYVwN1Kw/exec';
const SHEET_ID = '1UzOEys7DGhSVMJjoU-VfNo54qeoUjJfKlxXW2Lhcb-s';

/* ============================================
    VALUE INPUT HEATMAP (Add value‚Ä¶)
   ============================================ */
const COLOR_NEUTRAL = '#ffffff';      // base background for empty/0
const COLOR_POS_MAX = '#18390E';      // more positive -> more green
const COLOR_NEG_MAX = '#3A1818';      // more negative -> more red
const MAX_ABS_VALUE = 5000;           // tune: value where color hits max

function lerpColor(hexA, hexB, t) {
  const a = hexA.match(/\w\w/g).map(x => parseInt(x, 16));
  const b = hexB.match(/\w\w/g).map(x => parseInt(x, 16));
  const rgb = a.map((v, i) => Math.round(v + (b[i] - v) * t));
  return `rgb(${rgb.join(',')})`;
}

function valueToBackgroundColor(value) {
  if (value == null || Number.isNaN(value)) return COLOR_NEUTRAL;

  const clamped = Math.max(-MAX_ABS_VALUE, Math.min(MAX_ABS_VALUE, value));
  const intensity = Math.abs(clamped) / MAX_ABS_VALUE;

  return clamped >= 0
    ? lerpColor(COLOR_NEUTRAL, COLOR_POS_MAX, intensity)
    : lerpColor(COLOR_NEUTRAL, COLOR_NEG_MAX, intensity);
}

function applyValueInputColor(inputEl) {
  const v = parseFloat(inputEl.value);
  inputEl.style.backgroundColor = valueToBackgroundColor(Number.isNaN(v) ? 0 : v);

  // readability: flip text color only when the tint gets dark
  if (!Number.isNaN(v) && Math.abs(v) > MAX_ABS_VALUE * 0.65) {
    inputEl.style.color = '#ffffff';
  } else {
    inputEl.style.color = '';
  }
}

/* ============================================
    APPLICATION STATE
   ============================================ */
let SNAP = null;
let MODE = 'totals';
let TIMEFRAME = '3d';
let IS_LOADING = false;

let DARK_MODE = false;
let CHART_SLIDE = 0;
const MAX_CHART_SLIDE = 2;

let MUTED_ACCOUNTS = new Set();
let MUTED_TYPES = new Set();

/* ============================================
    UTILITIES
   ============================================ */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));

function setLoading(isLoading) {
  IS_LOADING = isLoading;
}

function showToast(msg, kind = 'info', ms = 1600) {
  const t = $('#toast');
  t.textContent = msg;
  t.style.display = 'block';
  t.style.borderColor = (kind === 'error') ? 'var(--c-neg)' : 'var(--c-border)';
  clearTimeout(showToast._timer);
  showToast._timer = setTimeout(() => { t.style.display = 'none'; }, ms);
}

function formatMoney(n) {
  const v = Number(n);
  if (!isFinite(v)) return '$0';
  const sign = v < 0 ? '-' : '';
  const abs = Math.abs(v);
  return `${sign}$${abs.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
}

function formatMoney2(n) {
  const v = Number(n);
  if (!isFinite(v)) return '$0.00';
  const sign = v < 0 ? '-' : '';
  const abs = Math.abs(v);
  return `${sign}$${abs.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
}

function clamp(n, a, b) {
  return Math.max(a, Math.min(b, n));
}

/* ============================================
    THEME / DARK MODE
   ============================================ */
function initializeTheme() {
  // placeholder for your existing theme init
}

function initDarkMode() {
  // placeholder for your existing dark mode init
}

/* ============================================
    MOBILE: ratio bar placement
   ============================================ */
function positionVisualRatioBarForViewport() {
  const ratio = document.getElementById('visual-ratio-bar');
  const toolbar = document.querySelector('header .toolbar');
  const toggleBtn = document.getElementById('mobile-toggle-btn');
  const header = document.querySelector('header');
  if (!ratio || !toolbar || !toggleBtn || !header) return;

  const isMobile = window.matchMedia('(max-width: 640px)').matches;

  if (isMobile) {
    // Mobile: keep the ratio bar ABOVE the Controls & Filters toggle/button
    if (ratio.parentElement !== toolbar || ratio.nextSibling !== toggleBtn) {
      toolbar.insertBefore(ratio, toggleBtn);
    }
  } else {
    // Desktop: keep the ratio bar at the bottom of the header (original vibe)
    if (ratio.parentElement !== header || ratio.nextSibling !== null) {
      header.appendChild(ratio);
    }
  }
}

/* ============================================
    DATA FETCH
   ============================================ */
async function api(route, params = {}) {
  const url = new URL(API_BASE);
  url.searchParams.set('route', route);
  Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));
  const res = await fetch(url.toString(), { method: 'GET' });
  if (!res.ok) throw new Error(`API ${route} failed`);
  return res.json();
}

async function fetchSnapshot() {
  try {
    setLoading(true);
    const data = await api('snapshot', { timeframe: TIMEFRAME, mode: MODE });
    SNAP = data;
    renderAll();
  } catch (e) {
    console.error(e);
    showToast('Refresh failed', 'error');
  } finally {
    setLoading(false);
  }
}

/* ============================================
    RENDERING
   ============================================ */
function renderAll() {
  renderFinancialSummary();
  renderChart();
  renderAccounts();
  renderTypeSummary();
  renderRatioBar();
}

function renderFinancialSummary() {
  if (!SNAP) return;
  const total = SNAP?.totals?.net ?? 0;
  const assets = SNAP?.totals?.assets ?? 0;
  const debt = SNAP?.totals?.debt ?? 0;
  $('#financial-summary').textContent = `Net: ${formatMoney(total)}  ‚Ä¢  Assets: ${formatMoney(assets)}  ‚Ä¢  Debt: ${formatMoney(debt)}`;
  $('#interest-summary').textContent = SNAP?.totals?.interestText ?? '';
}

function renderChart() {
  // (your existing chart renderer would live here)
  const c = $('#chart');
  c.textContent = '';
  const p = document.createElement('div');
  p.style.opacity = '0.75';
  p.style.fontWeight = '800';
  p.textContent = 'Chart renders here (unchanged)';
  c.appendChild(p);

  const pager = $('#chart-pager');
  pager.textContent = '';
}

function renderRatioBar() {
  if (!SNAP) return;
  const assets = Math.max(0, Number(SNAP?.totals?.assets ?? 0));
  const debt = Math.max(0, Math.abs(Number(SNAP?.totals?.debt ?? 0)));
  const sum = Math.max(1, assets + debt);
  const aPct = (assets / sum) * 100;
  const dPct = (debt / sum) * 100;
  $('#ratio-asset').style.width = `${aPct}%`;
  $('#ratio-debt').style.width = `${dPct}%`;
}

function renderAccounts() {
  const root = $('#accounts');
  root.textContent = '';
  const accounts = SNAP?.accounts ?? [];

  accounts.forEach((a) => {
    const row = document.createElement('div');
    row.className = 'account';

    const left = document.createElement('div');
    const right = document.createElement('div');
    right.className = 'values';

    const accountDetails = document.createElement('div');
    accountDetails.className = 'account-details';

    const name = document.createElement('div');
    name.className = 'name';
    name.textContent = a.name ?? 'Account';
    left.appendChild(name);

    const sub = document.createElement('div');
    sub.className = 'sub';
    sub.textContent = a.type ?? '';
    left.appendChild(sub);

    right.innerHTML = `${formatMoney(a.current ?? 0)}<div class="sub">${(a.deltaText ?? '')}</div>`;

    // stacked meta on the right of name
    const metaWrap = document.createElement('div');
    metaWrap.className = 'account-meta-stack';

    if (a.limit != null) {
      const lim = document.createElement('div');
      lim.innerHTML = `<span style="font-weight:900;">CC LIMIT</span> ${formatMoney(a.limit)}`;
      metaWrap.appendChild(lim);
    }
    if (a.ccDebt != null) {
      const debt = document.createElement('div');
      debt.innerHTML = `<span style="font-weight:900;">CC DEBT</span> ${formatMoney(a.ccDebt)}`;
      metaWrap.appendChild(debt);
    }
    if (a.apr != null) {
      const aprEl = document.createElement('div');
      const apr = Number(a.apr);
      const interestAmount = Number(a.interestAmount ?? 0);
      const periodLabel = a.interestPeriodLabel ?? '';
      let aprHTML = `<span style="font-weight:900;">APR</span> ${(apr * 100).toFixed(2)}%`;
      if (Math.abs(interestAmount) >= 0.01) {
        const sign = interestAmount >= 0 ? '+' : '';
        const color = interestAmount >= 0 ? 'var(--c-pos)' : 'var(--c-neg)';
        aprHTML += `<br><span style="color: ${color}">${sign}${formatMoney(interestAmount)}${periodLabel}</span>`;
      }
      aprEl.innerHTML = aprHTML;
      metaWrap.appendChild(aprEl);
    }

    accountDetails.appendChild(metaWrap);
    row.appendChild(left);
    row.appendChild(right);

    const inputLine = document.createElement('div'); inputLine.className = 'input-line';

    const inp = document.createElement('input');
    inp.className = 'value-input';
    inp.type = 'number';
    inp.inputMode = 'decimal';
    inp.placeholder = 'Add value‚Ä¶';
    inp.step = '0.01';
    inp.dataset.accountName = a.name;

    // Heatmap tint: value-driven (positive -> green, negative -> red)
    inp.addEventListener('input', () => applyValueInputColor(inp));
    applyValueInputColor(inp);

    inp.onkeydown = async (ev) => {
      if (ev.key === 'Enter') {
        await submitEntries([{ account: a.name, value: inp.value, inputEl: inp }]);
      }
    };

    const muteWrapper = document.createElement('label'); muteWrapper.className = 'mute-checkbox';
    const muteCheck = document.createElement('input'); muteCheck.type = 'checkbox';
    muteCheck.checked = MUTED_ACCOUNTS.has(a.name);
    muteCheck.addEventListener('change', () => {
      if (muteCheck.checked) MUTED_ACCOUNTS.add(a.name);
      else MUTED_ACCOUNTS.delete(a.name);
      renderAll();
    });
    const muteText = document.createElement('span'); muteText.textContent = 'Mute';
    muteWrapper.appendChild(muteCheck);
    muteWrapper.appendChild(muteText);

    inputLine.appendChild(inp);
    inputLine.appendChild(muteWrapper);

    row.appendChild(inputLine);
    root.appendChild(row);
  });
}

function renderTypeSummary() {
  const el = $('#type-summary');
  el.textContent = '';
  const types = SNAP?.types ?? [];
  types.forEach(t => {
    const b = document.createElement('button');
    b.textContent = `${t.name}: ${formatMoney(t.total)}`;
    b.addEventListener('click', () => showToast('Type clicked'));
    el.appendChild(b);
  });
}

/* ============================================
    SUBMIT
   ============================================ */
async function submitEntries(entries) {
  try {
    setLoading(true);
    entries.forEach(e => e.inputEl?.classList.add('submitting'));

    await api('submit', {
      entries: JSON.stringify(entries.map(e => ({ account: e.account, value: e.value })))
    });

    entries.forEach(e => { if (e.inputEl) e.inputEl.value = ''; applyValueInputColor(e.inputEl); });
    showToast('Submitted');
    await fetchSnapshot();
  } catch (e) {
    console.error(e);
    showToast('Submit failed', 'error');
  } finally {
    setLoading(false);
    entries.forEach(e => e.inputEl?.classList.remove('submitting'));
  }
}

/* ============================================
    STATE FROM URL
   ============================================ */
function loadStateFromURL() {
  const sp = new URLSearchParams(location.search);
  TIMEFRAME = sp.get('timeframe') || TIMEFRAME;
  MODE = sp.get('mode') || MODE;

  $('#timeframe').value = TIMEFRAME;
  $('#timeframe2').value = TIMEFRAME;
  $('#mode').value = MODE;
  $('#mode2').value = MODE;
}

/* ============================================
    INITIALIZATION
   ============================================ */
document.addEventListener('DOMContentLoaded', () => {
  loadStateFromURL();
  initializeTheme();
  initDarkMode();

  // Keep the horizontal ratio bar above Controls on mobile
  positionVisualRatioBarForViewport();
  window.addEventListener('resize', positionVisualRatioBarForViewport);

  const sheetLink = document.querySelector('footer a[href*="docs.google.com"]');
  if (sheetLink && SHEET_ID && SHEET_ID !== 'YOUR_SHEET_ID_HERE') {
    sheetLink.href = `https://docs.google.com/spreadsheets/d/${SHEET_ID}`;
  }

  document.getElementById('refresh').addEventListener('click', fetchSnapshot);
  document.getElementById('refresh2').addEventListener('click', fetchSnapshot);

  document.getElementById('submitAll').addEventListener('click', () => showToast('Submit All (wire to your existing logic)'));
  document.getElementById('submitAll2').addEventListener('click', () => showToast('Submit All (wire to your existing logic)'));

  const syncSelects = (a, b) => {
    a.addEventListener('change', () => { b.value = a.value; });
    b.addEventListener('change', () => { a.value = b.value; });
  };
  syncSelects($('#timeframe'), $('#timeframe2'));
  syncSelects($('#mode'), $('#mode2'));

  // Mobile controls toggle (simple show/hide of header controls)
  const mobileBtn = $('#mobile-toggle-btn');
  const toggleIcon = $('#toggle-icon');
  mobileBtn.addEventListener('click', () => {
    const tc = document.querySelector('.toolbar-controls');
    const tr = document.querySelector('.type-filter-row');
    const isHidden = getComputedStyle(tc).display === 'none';
    tc.style.display = isHidden ? 'flex' : 'none';
    tr.style.display = isHidden ? 'flex' : 'none';
    toggleIcon.textContent = isHidden ? '‚ñ≤' : '‚ñº';
  });

  // First load
  fetchSnapshot();
});
</script>

</body>
</html>
```

