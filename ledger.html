<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ledger ‚Äî Accounts & Chart (v1k)</title>
  
  <style>
    /* ============================================
       CSS VARIABLES & DESIGN TOKENS
       ============================================
       Centralized color palette and spacing values
       for consistent theming throughout the app.
    */
    :root {
      --maxw: 1400px;           /* Maximum content width */
      --c-pos: #4c8036;         /* Positive values (assets, gains) - Green */
      --c-neg: #a02d2a;         /* Negative values (debts, losses) - Red */
      --c-black: #000000;       /* Primary text and borders */
      --c-white: #ffffff;       /* Background and inverted text */
      --radius: 10px;           /* Border radius for rounded elements */
      --gap: 12px;              /* Standard spacing gap */
      
      /* Tinted backgrounds for input fields based on account type */
      --c-tint-pos: #f7f9f4;    /* Light green tint for positive accounts */
      --c-tint-neg: #f9f4f4;    /* Light red tint for negative accounts */
    }

    /* ============================================
       BASE LAYOUT
       ============================================
       Foundation styles for html, body, and main
       content wrapper with responsive width.
    */
    html, body { 
      height: 100%; 
      margin: 0; 
      background: var(--c-white); 
      color: var(--c-black); 
    }
    
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 18px;
      line-height: 1.5;
    }

    /* Wrapper constrains content width while allowing full-width elements */
    .wrap { 
      width: 90vw; 
      max-width: var(--maxw); 
      margin: 0 auto; 
      padding: 0px;  /* Zero padding allows nested full-width elements */
    }

    a {
      color: var(--c-black);
      text-decoration: underline;
    }

    /* ============================================
       HEADER & TOOLBAR
       ============================================
       Sticky header with financial summary and controls.
       Chart container sits below toolbar but within header.
    */
    header { 
      position: sticky; 
      top: 0; 
      background: var(--c-white); 
      z-index: 5; 
      border-bottom: 1px solid var(--c-black);
      padding-bottom: 1rem;  /* Add padding for statusbar */
    }
    
    /* Toolbar contains financial summary (left) and controls (right) */
    .toolbar { 
      display: flex; 
      gap: var(--gap); 
      align-items: baseline;  /* FIXED: Align to baseline */
      justify-content: space-between;
      padding: 6px 24px;  /* Increased horizontal padding for breathing room */
      flex-wrap: wrap; 
      width: 100%;  /* Full viewport width */
      box-sizing: border-box;  /* Include padding in width calculation */
    }
    
    /* Group for financial numbers (summary + interest) */
    .financial-group {
      display: flex;
      gap: var(--gap);
      align-items: baseline;
      flex-wrap: wrap;
      min-width: 0;  /* Allow shrinking */
      flex-shrink: 1;  /* Allow group to shrink if needed */
    }
    
    /* Controls group: timeframe selector, mode toggles, action buttons */
    .toolbar-controls {
      display: flex;
      gap: var(--gap);
      align-items: center;
      flex-wrap: wrap;
      flex-shrink: 0;
    }
    
    .toolbar label { 
      font-size: .85rem; 
      cursor: pointer;
    }
    
    .toolbar select {
      font-size: .85rem;
      padding: 4px;
      border: 1px solid var(--c-black);
      border-radius: 4px;
      background: var(--c-white);
      color: var(--c-black);
    }
    
    /* ============================================
       FINANCIAL SUMMARY
       ============================================
       Large, prominent display of total assets and debts.
       Updates dynamically based on data and timeframe.
    */
    #financial-summary {
      font-size: 3.9rem;
      font-weight: 700;
      white-space: nowrap;
      line-height: 1.1;
      flex-shrink: 1;
      min-width: 0;
    }
    
    /* Total interest costs/earnings display */
    #interest-summary {
      font-size: 1.95rem;  /* Half of main summary */
      font-weight: 600;
      white-space: nowrap;
      line-height: 1.1;
      flex-shrink: 1;
      min-width: 0;
      opacity: 0.9;
    }
    
    .interest-earned {
      color: var(--c-pos);
    }
    
    .interest-cost {
      color: var(--c-neg);
    }
    
    .summary-debt {
      color: var(--c-neg);
    }

    .summary-asset {
      color: var(--c-pos);
    }

    /* ============================================
       CHART CONTAINER
       ============================================
       Google Charts visualization area.
       Spans full viewport width for maximum impact.
    */
    #chart { 
      height: 30vh; 
      width: 100%; 
      margin: 0;
      padding: 0;
    }
    
    /* ============================================
       GLOBAL STATUSBAR
       ============================================
       100-block proportional visualization of asset/debt ratio.
       Red blocks = debt proportion, Green blocks = asset proportion.
       Font size scales responsively to fit all blocks on any screen.
    */
    #statusbar {
      font-size: clamp(0.5rem, 2.5vw, 3rem);  /* Slightly smaller max to ensure fit */
      line-height: 1;
      text-align: center;
      padding: 0.5rem 12px 0 12px;  /* Add horizontal padding */
      letter-spacing: -0.15em;  /* Tighter spacing to fit all blocks */
      overflow-x: auto;  /* Allow horizontal scroll if needed */
      overflow-y: hidden;
      white-space: nowrap;
      word-break: keep-all;
      background: var(--c-white);
      width: 100%;
      box-sizing: border-box;
    }
    
    .status-positive {
      color: var(--c-pos);
    }
    
    .status-negative {
      color: var(--c-neg);
    }
    
    hr.divider {
      border: none;
      border-top: 1px solid var(--c-black);
      margin-top: 1rem;
    }

    /* ============================================
       ACCOUNT ROWS
       ============================================
       Each account displays as a row with:
       - Left: account details, APR, input field
       - Right: historical values (chips) or ratio bar (mobile)
    */
    .accounts { 
      display: grid; 
      grid-template-columns: 1fr; 
      gap: var(--gap); 
    }
    
    .row { 
      display: flex; 
      align-items: flex-start; 
      justify-content: space-between; 
      border-bottom: 1px solid var(--c-black);
      padding: 12px 0; 
      gap: 12px; 
    }

    /* Left side: Account name, current balance, APR, input */
    .left { 
      flex: 1 1 auto; 
      padding-right: 12px; 
      min-width: 0; 
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start; 
      justify-content: space-between; 
      gap: var(--gap);
    }
    
    /* Right side: Historical value chips or mobile ratio bar */
    .right { 
      flex: 0 1 auto; 
      min-width: 40%; 
      text-align: right; 
      font-size: .9rem; 
    }

    .account-details {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: var(--gap);
      min-width: 0;
    }

    /* Current account balance (large, prominent) */
    .lastval { 
      font-weight: 600; 
      font-size: 2.6rem; 
      white-space: nowrap;
    }
    
    /* Account name (large, prominent) */
    .name { 
      font-weight: 700; 
      color: var(--c-black); 
      font-size: 2.6rem; 
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* APR percentage and calculated interest cost/earning */
    .apr { 
      font-weight: 400; 
      font-size: 0.75rem;
      opacity: .75; 
      flex-shrink: 0;
      padding-top: 0.5rem;
    }

    /* Input field container */
    .input-line { 
      display: flex; 
      gap: 10px; 
      align-items: center; 
      flex-shrink: 0;
      padding-top: 0.25rem;
    }

    /* ============================================
       INPUT FIELDS
       ============================================
       Number inputs for adding new account values.
       Background color tints based on account type.
    */
    input[type="number"] {
      width: 10rem;
      max-width: 10rem;
      padding: .7rem .8rem;
      font-size: 1.1rem;
      border: 2px solid var(--c-black);
      border-radius: var(--radius);
      background: var(--c-white);
      color: var(--c-black);
      outline: none;
      transition: background-color 0.3s ease;
    }
    
    input[type="number"]::placeholder {
      color: var(--c-black);
      opacity: 0.6;
    }
    
    input[type="number"]:focus {
      border-color: var(--c-black);
      box-shadow: 0 0 0 2px var(--c-black) inset;
    }
    
    /* Loading state during submission */
    input[type="number"].submitting {
      opacity: 0.5;
      pointer-events: none;
    }
    
    /* Success animation after submission */
    input[type="number"].submitted-ok {
      animation: flash-green 0.8s ease-out;
    }
    
    @keyframes flash-green {
      0% { box-shadow: 0 0 0 2px var(--c-pos) inset; }
      100% { box-shadow: 0 0 0 0px var(--c-pos) inset; }
    }

    /* Color coding for positive/negative values */
    .values [data-sign="pos"], .lastval[data-sign="pos"] { color: var(--c-pos); }
    .values [data-sign="neg"], .lastval[data-sign="neg"] { color: var(--c-neg); }

    /* ============================================
       BUTTONS
       ============================================
       Action buttons with hover and disabled states.
    */
    button {
      padding: .7rem 1rem;
      font-size: 1rem;
      border: 2px solid var(--c-black);
      color: var(--c-black);
      background: var(--c-white);
      cursor: pointer;
      border-radius: var(--radius);
    }
    
    button:hover { 
      background: var(--c-white);
      text-decoration: underline;
    }
    
    button:focus-visible { 
      outline: 3px solid var(--c-black); 
      outline-offset: 2px; 
    }
    
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* ============================================
       VALUE CHIPS
       ============================================
       Historical account values displayed as chips.
       Clickable for deletion (double-click or right-click).
    */
    .values { 
      display: flex; 
      justify-content: flex-end;
      gap: .6rem; 
      overflow-x: auto;  /* Horizontal scroll for many values */
      width: 100%;       /* Fixed width enables overflow scrolling */
    }
    
    .chip {
      padding: .25rem .6rem;
      border-radius: 999px;
      border: 1px solid var(--c-black);
      font-variant-numeric: tabular-nums;
      font-size: .95rem;
      cursor: pointer;
      user-select: none;
      flex-shrink: 0;  /* Prevent chip compression */
    }
    
    .chip:hover {
      background: var(--c-black);
      color: var(--c-white);
    }
    
    /* Non-deletable chips (from older data format) */
    .chip.no-delete {
      cursor: default;
      opacity: 0.7;
      background: transparent;
      color: var(--c-black);
    }
    .chip.no-delete:hover {
      background: transparent;
    }
    
    /* ============================================
       MOBILE RATIO BARS
       ============================================
       Proportional visualization for individual accounts.
       Shows account's percentage of total assets or debts.
       Hidden on desktop, visible on mobile (< 650px).
    */
    .ratio-bar {
      display: none;  /* Hidden by default (desktop) */
      font-size: 1.5rem;
      margin: 0;
      padding: 0;
      white-space: nowrap;
      letter-spacing: -1px;
    }
    .ratio-bar span {
      display: inline-block;
    }

    footer { 
      padding: 16px 0 24px; 
      text-align: right; 
    }
    
    /* ============================================
       TOAST NOTIFICATIONS
       ============================================
       Temporary notifications for user feedback.
       Auto-dismiss after specified duration.
    */
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: var(--radius);
      background: var(--c-black);
      color: var(--c-white);
      border: 2px solid var(--c-white);
      font-weight: 500;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease, bottom 0.3s ease;
    }
    
    #toast.show {
      opacity: 1;
      visibility: visible;
      bottom: 30px;
    }
    
    #toast[data-type="error"] {
      background: var(--c-neg);
      color: var(--c-white);
      border-color: var(--c-white);
    }
    
    #toast[data-type="success"] {
      background: var(--c-pos);
      color: var(--c-white);
      border-color: var(--c-white);
    }
    
    /* ============================================
       DELETE CONFIRMATION MODAL
       ============================================
       Modal dialog for confirming entry deletion.
       Backdrop dims the page, modal centers on screen.
    */
    #delete-modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 200;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    #delete-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--c-white);
      color: var(--c-black);
      border: 2px solid var(--c-black);
      border-radius: var(--radius);
      z-index: 201;
      padding: 24px;
      width: 90vw;
      max-width: 400px;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease, top 0.3s ease;
    }
    
    #delete-modal-backdrop.show,
    #delete-modal.show {
      display: block;
      opacity: 1;
    }
    
    #delete-modal p {
      margin-top: 0;
      line-height: 1.4;
    }
    
    #delete-modal-details {
      font-weight: 600;
      display: block;
      margin: 12px 0;
      font-size: 1.1rem;
    }
    
    #delete-modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    #delete-btn-confirm {
      background: var(--c-neg);
      color: var(--c-white);
      border-color: var(--c-neg);
    }
    #delete-btn-confirm:hover {
      background: #802421;
      border-color: #802421;
      text-decoration: none;
    }

    /* ============================================
       MOBILE RESPONSIVE (< 650px)
       ============================================
       Layout adjustments for mobile devices:
       - Stack elements vertically
       - Hide value chips, show ratio bars
       - Full-width inputs
       - Centered financial summary
    */
    @media (max-width: 650px) {
      .row {
        flex-direction: column;
      }
      
      .right { 
        min-width: unset; 
        text-align: left; 
        align-self: flex-start;
        padding-top: 0.5rem; 
      }
      
      /* Hide chips, show ratio bars on mobile */
      .right .values {
        display: none;
      }
      .right .ratio-bar {
        display: block;
      }

      .left {
        gap: 8px;
        width: 100%;
        padding-right: 0;
      }
      
      input[type="number"] { 
        width: 100%; 
        max-width: 100%;
      }
      
      .input-line {
        width: 100%;
        margin-left: 0;
        padding-top: 0;
      }
      
      .apr {
        padding-top: 0;
      }
      
      .toolbar { 
        flex-direction: column; 
        align-items: flex-start;
        justify-content: flex-start;
        padding: 6px 24px;
      }
      
      .financial-group {
        flex-direction: column;
        align-items: center;
        width: 100%;
      }
      
      #financial-summary {
        font-size: 3.9rem;
        padding-bottom: 8px;
        width: 100%;
        text-align: center;
      }
      
      #interest-summary {
        font-size: 1.95rem;
        width: 100%;
        text-align: center;
        padding-bottom: 8px;
      }
    
      .toolbar-controls {
        justify-content: space-around;
        width: 100%;
      }
      
      .lastval, .name {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Toast notification container -->
  <div id="toast" role="status" aria-live="polite"></div>
  
  <!-- Delete confirmation modal -->
  <div id="delete-modal-backdrop"></div>
  <div id="delete-modal" role="alertdialog" aria-modal="true" aria-labelledby="delete-modal-title">
    <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
    <p>Do you really want to delete this entry?</p>
    <span id="delete-modal-details"></span>
    <div id="delete-modal-buttons">
      <button id="delete-btn-cancel">Cancel</button>
      <button id="delete-btn-confirm">Yes, Delete</button>
    </div>
  </div>

  <!-- Main header with toolbar and chart -->
  <header>
    <div class="toolbar">
      <!-- Financial numbers group (left) -->
      <div class="financial-group">
        <div id="financial-summary"></div>
        <div id="interest-summary"></div>
      </div>
      
      <!-- Controls group (right) -->
      <div class="toolbar-controls">
        <label for="timeframe">Timeframe:</label>
        <select id="timeframe">
          <option value="ytd" selected>This Calendar Year</option>
          <option value="today">Today</option>
          <option value="7d">Last 7 Days</option>
          <option value="14d">Last 14 Days</option>
          <option value="30d">Last 30 Days</option>
          <option value="90d">Last 90 Days</option>
          <option value="1y">Last Year (12mo)</option>
          <option value="all">All Time</option>
        </select>
        
        <label><input type="radio" name="mode" value="totals" checked> Totals</label>
        <label><input type="radio" name="mode" value="accounts"> Per-account</label>
        
        <button id="refresh" aria-label="Refresh data">Refresh</button>
        <button id="submitAll">Submit All</button>
      </div>
    </div>
    
    <!-- Google Charts visualization -->
    <div id="chart"></div>
    
    <!-- Global statusbar: 100-block asset/debt ratio visualization (part of sticky header) -->
    <section id="statusbar"></section>
  </header>

  <hr class="wrap divider">

  <!-- Main content: Account list -->
  <main class="wrap">
    <section id="accounts" class="accounts"></section>
    <footer>
      <small>Enter value(s) and press <b>Enter</b> or <b>Submit All</b>. Double-click an entry to delete. <br>Values displayed are truncated to whole numbers.</small>
    </footer>
  </main>

  <script>
  /* ============================================
     CONFIGURATION
     ============================================
     API endpoint for Google Apps Script backend.
     Replace with your own deployment URL.
  */
configuration (for future view types)
function renderChart() { /* totals + accounts mode */ }
function renderDonut() { /* future - Phase 3 */ }
function renderTowers() { /* future - Phase 3 */ }
function renderPie() { /* future - Phase 3 */ }

// Footer links (for future additions)
<div class="security-notice">...</div>
<div class="footer-links">
  <a href="..." id="sheet-link">üìä Database</a>
  <a href="#" id="ask-ai">ü§ñ AI</a>
</div>
<small>Usage instructions...</small>

Common Issues & Solutions
Issue 1: Chart Doesn't Stack Properly
Symptom: Areas overlap instead of stacking
Solution: Ensure isStacked: true is in options object
Check: All series must have numeric values (not null/undefined)
Issue 2: Colors Look Washed Out
Symptom: Stacked areas too transparent
Solution: Adjust areaOpacity from 0.75 to 0.85 or 0.95
javascriptareaOpacity: 0.85,  // More solid
Issue 3: Footer Text Unreadable on Mobile
Symptom: 0.7rem too small on phones
Solution: Add responsive sizing
css@media (max-width: 650px) {
  footer, footer small, footer a {
    font-size: 0.75rem;  /* Slightly larger on mobile */
  }
}
Issue 4: Security Notice Box Too Wide
Symptom: Overflows on narrow screens
Solution: Already handled with max-width: 900px and margin: 16px auto

Validation Steps
Before Committing
bash# 1. Test in multiple browsers
# Chrome, Firefox, Safari (if Mac), Edge

# 2. Test on mobile device
# Use browser DevTools mobile emulation: F12 ‚Üí Device Toolbar

# 3. Test all chart modes
# - Switch between Totals/Per-account
# - Try all timeframes (Today, 7d, 30d, YTD, All)

# 4. Test footer
# - Scroll to bottom
# - Check readability
# - Click any links (if added)

# 5. Check console
# F12 ‚Üí Console ‚Üí No red errors
Git Commit Message
bashgit add ledger-v2.html
git commit -m "feat(phase1): Add filled charts, tiny footer, security notice

- Change chart from line to stacked area (seriesType: 'area')
- Set areaOpacity: 0.75 for solid color fills
- Shrink footer to 0.7rem for elegance
- Add security disclaimer with green border
- Future-proof: Foundation for swipe views and footer links

Tested: Chrome, Firefox, mobile emulation
Impact: High visual improvement, builds user trust"

Time Estimate
TaskTimeCumulativeFeature 1: Chart fills15 min15 minFeature 2: Footer styling10 min25 minFeature 3: Security notice10 min35 minTesting all 315 min50 minDocumentation10 min60 min
Total: ~1 hour (much faster than estimated 4 hours because these are simple CSS/config changes!)

Next Phase 1 Features (After These 3)
Once you've shipped these 3, the logical next additions are:
4. Google Sheet Link (5 minutes)
html<a href="YOUR_SHEET_URL" target="_blank">üìä Edit Database</a>
5. Account Percentages (Mobile) (2 hours)

Add calculation to renderAccounts()
Display next to ratio bars

6. Font Weight Adjustment (2 minutes)
css#financial-summary { font-weight: 400; }
But START with these 3. Ship them. Get feedback. Then continue.

üéâ Summary
You're implementing:

‚úÖ Filled chart colors (stacked areas)
‚úÖ Tiny footer (0.7rem)
‚úÖ Security disclaimer (green box)

Why these 3:

Visual impact: Charts look professional
Foundation: Footer ready for additions
Trust: Security message upfront
Low risk: CSS/HTML only
Fast: ~1 hour total

After shipping:

Users see beautiful stacked charts immediately
Footer is elegant and expandable
Privacy message builds trust
You have momentum for Phase 2!

Now go code! You've got this. üöÄRetryPCreate a new output of the full html  code to make sure all items in the toolbar are font-weight lightger, except the larger postive of neagative number, for example +6000 and -6001 the -6001 would be cosidered the bigger number here and would appear font-weight:bold but all other things including interest-summary should appear with font-weight lighter please.Creating complete Ledger v2.1 HTML with Phase 1 features: filled charts, tiny footer, security notice, and smart font weight logic (only largest absolute value is bold)ledger-v2.1-phase1.htmlüéâ Complete! Ledger v2.1 Phase 1
‚úÖ What's Included
ledger-v2.1-phase1.html
All 3 Phase 1 Features Implemented:
1. ‚úÖ Filled Chart Colors (Stacked Areas)
javascriptseriesType: 'area',
isStacked: true,
areaOpacity: 0.75,
lineWidth: 2
2. ‚úÖ Tiny Footer with Security Notice
cssfooter { font-size: 0.7rem; }
.security-notice { 
  border-left: 3px solid var(--c-pos);
  background: #f8f8f8;
}
3. ‚úÖ Smart Font Weight Logic
Only the larger absolute value is bold:

If assets ($6,000) > debts ($5,000) ‚Üí Assets are bold, debts are light
If debts ($6,001) > assets ($6,000) ‚Üí Debts are bold, assets are light
If equal ‚Üí Both light (no bold)

All other toolbar text is light (300 weight):

Interest summary
Labels ("Timeframe:")
Select dropdowns
Buttons


üéØ Key CSS Changes
Smart Bolding
css#financial-summary {
  font-weight: 300;  /* Default: light */
}

#financial-summary .bold-value {
  font-weight: 700;  /* Applied to larger value only */
}
Toolbar Weight
css.toolbar label { font-weight: 300; }
.toolbar select { font-weight: 300; }
button { font-weight: 300; }
#interest-summary { font-weight: 300; }
```

---

## üß™ Testing Instructions

### 1. Visual Check
- **Open file** in browser
- **Assets/Debts:** Larger number should be bold, smaller light
- **Interest:** Always light (never bold)
- **Toolbar:** All text light weight
- **Chart:** Stacked areas with color fills
- **Footer:** Tiny (11px), security box with green border

### 2. Interaction Test
- **Switch timeframes:** Chart updates with filled areas
- **Toggle modes:** Totals vs Per-account both stack properly
- **Click chips:** Edit modal works
- **Long-press names:** Account menu appears

### 3. Edge Cases
- **Equal values:** Assets = $1,000, Debts = $1,000 ‚Üí Both light (no bold)
- **Mobile:** Footer readable at 0.75rem (slightly larger)
- **Chart:** All accounts visible in stacked mode

---

## üìä Before/After Comparison

| Element | v2.0 | v2.1 Phase 1 |
|---------|------|--------------|
| **Chart** | Line chart | **Filled stacked areas** ‚ú® |
| **Font weights** | All bold (700) | **Smart: only largest bold** ‚ú® |
| **Interest** | Bold | **Light (300)** ‚ú® |
| **Toolbar** | Normal (400) | **Light (300)** ‚ú® |
| **Footer** | Large (18px) | **Tiny (11px)** ‚ú® |
| **Security** | None | **Green-bordered notice** ‚ú® |

---

## üé® Smart Font Logic Explained

### Example 1: Assets Win
```
Assets: $8,500 (BOLD)
Debts:  $3,200 (light)

HTML:
<span class="summary-asset bold-value">$8,500</span>
<span class="summary-debt">$3,200</span>
```

### Example 2: Debts Win
```
Assets: $1,200 (light)
Debts:  $5,700 (BOLD)

HTML:
<span class="summary-asset">$1,200</span>
<span class="summary-debt bold-value">$5,700</span>
```

### Example 3: Tie
```
Assets: $5,000 (light)
Debts:  $5,000 (light)

Both stay light - no bold!

üöÄ What's Next?
Immediate shipping:
This file is production-ready. Deploy it!
Quick additions (5-10 minutes each):

Google Sheet link in footer
Account percentage display (mobile)
Optional: Adjust areaOpacity if fills too transparent

Phase 2 (next sprint):

Collapsible notes
Account ledger pages
Website URL editing


üí° Pro Tips
If Chart Feels Too Transparent
Change this line:
javascriptareaOpacity: 0.85,  // More opaque (was 0.75)
If Footer Too Small on Mobile
Already handled! CSS includes:
css@media (max-width: 650px) {
  footer, footer small, footer a, .security-notice {
    font-size: 0.75rem;  /* Slightly larger */
  }
}
If Colors Clash
Adjust account colors in Google Sheet "Accounts" tab, column D

Ship it! This is a complete, polished Phase 1 release. üéäLedger v2.1 phase1Code ¬∑ HTML¬†DownloadRetryClaude can make mistakes. Please double-check responses.Session limit reached ‚àô resets 3:00 AMSubscribe to MaxCreate a new output of the full html  code to make sure all items in the toolbar are font-weight lightger, except the larger postive of neagative number, for example +6000 and -6001 the -6001 would be cosidered the bigger number here and would appear font-weight:bold but all other things including interest-summary should appear with font-weight lighter please. Sonnet 4.5Ledger v2.1 phase1 ¬∑ HTMLCopy1<!doctype html>
2<html lang="en">
3<head>
4  <meta charset="utf-8"/>
5  <meta name="viewport" content="width=device-width, initial-scale=1"/>
6  <title>Ledger ‚Äî Accounts & Chart (v2.1)</title>
7  
8  <style>
9    /* ============================================
10       CSS VARIABLES & DESIGN TOKENS
11       ============================================ */
12    :root {
13      --maxw: 1400px;
14      --c-pos: #4c8036;
15      --c-neg: #a02d2a;
16      --c-black: #000000;
17      --c-white: #ffffff;
18      --radius: 10px;
19      --gap: 12px;
20      --c-tint-pos: #f7f9f4;
21      --c-tint-neg: #f9f4f4;
22    }
23
24    /* ============================================
25       BASE LAYOUT
26       ============================================ */
27    html, body { 
28      height: 100%; 
29      margin: 0; 
30      background: var(--c-white); 
31      color: var(--c-black); 
32    }
33    
34    body {
35      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
36      font-size: 18px;
37      line-height: 1.5;
38    }
39
40    .wrap { 
41      width: 90vw; 
42      max-width: var(--maxw); 
43      margin: 0 auto; 
44      padding: 0px;
45    }
46
47    a {
48      color: var(--c-black);
49      text-decoration: underline;
50    }
51
52    /* ============================================
53       HEADER & TOOLBAR
54       ============================================ */
55    header { 
56      position: sticky; 
57      top: 0; 
58      background: var(--c-white); 
59      z-index: 5; 
60      border-bottom: 1px solid var(--c-black);
61      padding-bottom: 1rem;
62    }
63    
64    .toolbar { 
65      display: flex; 
66      gap: var(--gap); 
67      align-items: baseline;
68      justify-content: space-between;
69      padding: 6px 24px;
70      flex-wrap: wrap; 
71      width: 100%;
72      box-sizing: border-box;
73    }
74    
75    .financial-group {
76      display: flex;
77      gap: var(--gap);
78      align-items: baseline;
79      flex-wrap: wrap;
80      min-width: 0;
81      flex-shrink: 1;
82    }
83    
84    .toolbar-controls {
85      display: flex;
86      gap: var(--gap);
87      align-items: center;
88      flex-wrap: wrap;
89      flex-shrink: 0;
90    }
91    
92    .toolbar label { 
93      font-size: .85rem;
94      font-weight: 300;  /* v2.1: Lighter weight */
95      cursor: pointer;
96    }
97    
98    .toolbar select {
99      font-size: .85rem;
100      font-weight: 300;  /* v2.1: Lighter weight */
101      padding: 4px;
102      border: 1px solid var(--c-black);
103      border-radius: 4px;
104      background: var(--c-white);
105      color: var(--c-black);
106    }
107    
108    /* ============================================
109       FINANCIAL SUMMARY
110       ============================================
111       v2.1: Smart bolding - only largest absolute value
112       ============================================ */
113    #financial-summary {
114      font-size: 3.9rem;
115      font-weight: 300;  /* v2.1: Default to lighter */
116      white-space: nowrap;
117      line-height: 1.1;
118      flex-shrink: 1;
119      min-width: 0;
120    }
121    
122    /* v2.1: Bold class applied dynamically to larger absolute value */
123    #financial-summary .bold-value {
124      font-weight: 700;
125    }
126    
127    /* v2.1: Interest summary always lighter */
128    #interest-summary {
129      font-size: 1.95rem;
130      font-weight: 300;  /* v2.1: Lighter weight */
131      white-space: nowrap;
132      line-height: 1.1;
133      flex-shrink: 1;
134      min-width: 0;
135      opacity: 0.9;
136    }
137    
138    .interest-earned {
139      color: var(--c-pos);
140    }
141    
142    .interest-cost {
143      color: var(--c-neg);
144    }
145    
146    .summary-debt {
147      color: var(--c-neg);
148    }
149
150    .summary-asset {
151      color: var(--c-pos);
152    }
153
154    /* ============================================
155       CHART CONTAINER
156       ============================================ */
157    #chart { 
158      height: 30vh; 
159      width: 100%; 
160      margin: 0;
161      padding: 0;
162    }
163    
164    /* ============================================
165       GLOBAL STATUSBAR (v2.0: Using ‚ñë character)
166       ============================================ */
167    #statusbar {
168      font-size: clamp(0.5rem, 2.5vw, 3rem);
169      line-height: 1;
170      text-align: center;
171      padding: 0.5rem 12px 0 12px;
172      letter-spacing: -0.15em;
173      overflow-x: auto;
174      overflow-y: hidden;
175      white-space: nowrap;
176      word-break: keep-all;
177      background: var(--c-white);
178      width: 100%;
179      box-sizing: border-box;
180    }
181    
182    .status-positive {
183      color: var(--c-pos);
184    }
185    
186    .status-negative {
187      color: var(--c-neg);
188    }
189    
190    hr.divider {
191      border: none;
192      border-top: 1px solid var(--c-black);
193      margin-top: 1rem;
194    }
195
196    /* ============================================
197       ACCOUNT ROWS
198       ============================================ */
199    .accounts { 
200      display: grid; 
201      grid-template-columns: 1fr; 
202      gap: var(--gap); 
203    }
204    
205    .row { 
206      display: flex; 
207      align-items: flex-start; 
208      justify-content: space-between; 
209      border-bottom: 1px solid var(--c-black);
210      padding: 12px 0; 
211      gap: 12px; 
212    }
213
214    .left { 
215      flex: 1 1 auto; 
216      padding-right: 12px; 
217      min-width: 0; 
218      display: flex;
219      flex-wrap: wrap;
220      align-items: flex-start; 
221      justify-content: space-between; 
222      gap: var(--gap);
223    }
224    
225    .right { 
226      flex: 0 1 auto; 
227      min-width: 40%; 
228      text-align: right; 
229      font-size: .9rem; 
230    }
231
232    .account-details {
233      display: flex;
234      flex-wrap: wrap;
235      align-items: flex-start;
236      gap: var(--gap);
237      min-width: 0;
238    }
239
240    .lastval { 
241      font-weight: 600; 
242      font-size: 2.6rem; 
243      white-space: nowrap;
244    }
245    
246    .name { 
247      font-weight: 700; 
248      color: var(--c-black); 
249      font-size: 2.6rem; 
250      white-space: nowrap;
251      overflow: hidden;
252      text-overflow: ellipsis;
253      cursor: pointer;
254      user-select: none;
255      position: relative;
256    }
257    
258    .name:hover {
259      opacity: 0.8;
260    }
261    
262    .name:active {
263      opacity: 0.6;
264    }
265    
266    .apr { 
267      font-weight: 400; 
268      font-size: 0.75rem;
269      opacity: .75; 
270      flex-shrink: 0;
271      padding-top: 0.5rem;
272    }
273
274    .input-line { 
275      display: flex; 
276      gap: 10px; 
277      align-items: center; 
278      flex-shrink: 0;
279      padding-top: 0.25rem;
280    }
281
282    /* ============================================
283       INPUT FIELDS
284       ============================================ */
285    input[type="number"], input[type="date"], input[type="text"] {
286      width: 10rem;
287      max-width: 10rem;
288      padding: .7rem .8rem;
289      font-size: 1.1rem;
290      border: 2px solid var(--c-black);
291      border-radius: var(--radius);
292      background: var(--c-white);
293      color: var(--c-black);
294      outline: none;
295      transition: background-color 0.3s ease;
296    }
297    
298    input[type="number"]::placeholder,
299    input[type="date"]::placeholder,
300    input[type="text"]::placeholder {
301      color: var(--c-black);
302      opacity: 0.6;
303    }
304    
305    input[type="number"]:focus,
306    input[type="date"]:focus,
307    input[type="text"]:focus {
308      border-color: var(--c-black);
309      box-shadow: 0 0 0 2px var(--c-black) inset;
310    }
311    
312    input[type="number"].submitting,
313    input[type="date"].submitting,
314    input[type="text"].submitting {
315      opacity: 0.5;
316      pointer-events: none;
317    }
318    
319    input[type="number"].submitted-ok,
320    input[type="date"].submitted-ok,
321    input[type="text"].submitted-ok {
322      animation: flash-green 0.8s ease-out;
323    }
324    
325    @keyframes flash-green {
326      0% { box-shadow: 0 0 0 2px var(--c-pos) inset; }
327      100% { box-shadow: 0 0 0 0px var(--c-pos) inset; }
328    }
329
330    .values [data-sign="pos"], .lastval[data-sign="pos"] { color: var(--c-pos); }
331    .values [data-sign="neg"], .lastval[data-sign="neg"] { color: var(--c-neg); }
332
333    /* ============================================
334       BUTTONS
335       ============================================ */
336    button {
337      padding: .7rem 1rem;
338      font-size: 1rem;
339      font-weight: 300;  /* v2.1: Lighter weight */
340      border: 2px solid var(--c-black);
341      color: var(--c-black);
342      background: var(--c-white);
343      cursor: pointer;
344      border-radius: var(--radius);
345    }
346    
347    button:hover { 
348      background: var(--c-white);
349      text-decoration: underline;
350    }
351    
352    button:focus-visible { 
353      outline: 3px solid var(--c-black); 
354      outline-offset: 2px; 
355    }
356    
357    button:disabled {
358      opacity: 0.4;
359      cursor: not-allowed;
360    }
361
362    /* ============================================
363       VALUE CHIPS (v2.0: Editable!)
364       ============================================ */
365    .values { 
366      display: flex; 
367      justify-content: flex-end;
368      gap: .6rem; 
369      overflow-x: auto;
370      width: 100%;
371    }
372    
373    .chip {
374      padding: .25rem .6rem;
375      border-radius: 999px;
376      border: 1px solid var(--c-black);
377      font-variant-numeric: tabular-nums;
378      font-size: .95rem;
379      cursor: pointer;
380      user-select: none;
381      flex-shrink: 0;
382      transition: all 0.2s ease;
383    }
384    
385    .chip:hover {
386      background: var(--c-black);
387      color: var(--c-white);
388      transform: scale(1.05);
389    }
390    
391    .chip.no-delete {
392      cursor: default;
393      opacity: 0.7;
394      background: transparent;
395      color: var(--c-black);
396    }
397    .chip.no-delete:hover {
398      background: transparent;
399      transform: none;
400    }
401    
402    /* ============================================
403       MOBILE RATIO BARS
404       ============================================ */
405    .ratio-bar {
406      display: none;
407      font-size: 1.5rem;
408      margin: 0;
409      padding: 0;
410      white-space: nowrap;
411      letter-spacing: -1px;
412    }
413    .ratio-bar span {
414      display: inline-block;
415    }
416
417    /* ============================================
418       FOOTER (v2.1: Tiny and elegant)
419       ============================================ */
420    footer { 
421      padding: 16px 24px 24px;
422      text-align: center;
423      font-size: 0.7rem;
424      line-height: 1.6;
425      opacity: 0.8;
426      color: var(--c-black);
427    }
428
429    footer small {
430      font-size: 0.7rem;
431      display: block;
432      margin-bottom: 8px;
433    }
434
435    footer a {
436      font-size: 0.7rem;
437      color: var(--c-black);
438      text-decoration: underline;
439      opacity: 0.9;
440    }
441
442    footer a:hover {
443      opacity: 1;
444      text-decoration: none;
445    }
446
447    footer b {
448      font-weight: 600;
449    }
450
451    /* v2.1: Security notice */
452    .security-notice {
453      font-size: 0.7rem;
454      background: #f8f8f8;
455      padding: 10px 14px;
456      border-radius: 8px;
457      margin: 16px auto 8px;
458      max-width: 900px;
459      border-left: 3px solid var(--c-pos);
460      text-align: left;
461      line-height: 1.5;
462    }
463
464    .security-notice strong {
465      font-weight: 700;
466      color: var(--c-pos);
467    }
468    
469    /* ============================================
470       TOAST NOTIFICATIONS
471       ============================================ */
472    #toast {
473      position: fixed;
474      bottom: 20px;
475      left: 50%;
476      transform: translateX(-50%);
477      padding: 12px 24px;
478      border-radius: var(--radius);
479      background: var(--c-black);
480      color: var(--c-white);
481      border: 2px solid var(--c-white);
482      font-weight: 500;
483      z-index: 100;
484      opacity: 0;
485      visibility: hidden;
486      transition: opacity 0.3s ease, visibility 0.3s ease, bottom 0.3s ease;
487    }
488    
489    #toast.show {
490      opacity: 1;
491      visibility: visible;
492      bottom: 30px;
493    }
494    
495    #toast[data-type="error"] {
496      background: var(--c-neg);
497      color: var(--c-white);
498      border-color: var(--c-white);
499    }
500    
501    #toast[data-type="success"] {
502      background: var(--c-pos);
503      color: var(--c-white);
504      border-color: var(--c-white);
505    }
506    
507    /* ============================================
508       MODALS (Shared styles)
509       ============================================ */
510    .modal-backdrop {
511      position: fixed;
512      top: 0;
513      left: 0;
514      width: 100%;
515      height: 100%;
516      background: rgba(0, 0, 0, 0.6);
517      z-index: 200;
518      display: none;
519      opacity: 0;
520      transition: opacity 0.3s ease;
521    }
522    
523    .modal {
524      position: fixed;
525      top: 50%;
526      left: 50%;
527      transform: translate(-50%, -50%);
528      background: var(--c-white);
529      color: var(--c-black);
530      border: 2px solid var(--c-black);
531      border-radius: var(--radius);
532      z-index: 201;
533      padding: 24px;
534      width: 90vw;
535      max-width: 400px;
536      display: none;
537      opacity: 0;
538      transition: opacity 0.3s ease, top 0.3s ease;
539    }
540    
541    .modal-backdrop.show,
542    .modal.show {
543      display: block;
544      opacity: 1;
545    }
546    
547    .modal h3 {
548      margin-top: 0;
549    }
550    
551    .modal p {
552      margin-top: 0;
553      line-height: 1.4;
554    }
555    
556    .modal-details {
557      font-weight: 600;
558      display: block;
559      margin: 12px 0;
560      font-size: 1.1rem;
561    }
562    
563    .modal-buttons {
564      display: flex;
565      gap: 12px;
566      justify-content: flex-end;
567      margin-top: 20px;
568    }
569    
570    .modal-form-group {
571      margin-bottom: 16px;
572    }
573    
574    .modal-form-group label {
575      display: block;
576      margin-bottom: 6px;
577      font-weight: 600;
578      font-size: 0.9rem;
579    }
580    
581    .modal-form-group input {
582      width: 100%;
583      max-width: 100%;
584      box-sizing: border-box;
585    }
586    
587    /* Delete modal */
588    #delete-btn-confirm {
589      background: var(--c-neg);
590      color: var(--c-white);
591      border-color: var(--c-neg);
592    }
593    #delete-btn-confirm:hover {
594      background: #802421;
595      border-color: #802421;
596      text-decoration: none;
597    }
598
599    /* Edit chip modal */
600    #edit-chip-modal .modal-form-group input[type="number"] {
601      font-size: 1.2rem;
602      padding: 0.8rem;
603    }
604    
605    #edit-chip-modal .modal-form-group input[type="date"] {
606      font-size: 1rem;
607      padding: 0.8rem;
608    }
609    
610    #edit-chip-save {
611      background: var(--c-pos);
612      color: var(--c-white);
613      border-color: var(--c-pos);
614    }
615    #edit-chip-save:hover {
616      background: #3d6629;
617      border-color: #3d6629;
618      text-decoration: none;
619    }
620
621    /* Account menu modal */
622    #account-menu-modal .modal-buttons {
623      flex-direction: column;
624    }
625    
626    #account-menu-modal .modal-buttons button {
627      width: 100%;
628      text-align: left;
629      padding: 1rem;
630      font-size: 1.1rem;
631    }
632    
633    #account-menu-delete {
634      background: var(--c-neg);
635      color: var(--c-white);
636      border-color: var(--c-neg);
637    }
638    #account-menu-delete:hover {
639      background: #802421;
640      border-color: #802421;
641    }
642    
643    #account-menu-add {
644      background: var(--c-pos);
645      color: var(--c-white);
646      border-color: var(--c-pos);
647    }
648    #account-menu-add:hover {
649      background: #3d6629;
650      border-color: #3d6629;
651    }
652
653    /* ============================================
654       MOBILE RESPONSIVE
655       ============================================ */
656    @media (max-width: 650px) {
657      .row {
658        flex-direction: column;
659      }
660      
661      .right { 
662        min-width: unset; 
663        text-align: left; 
664        align-self: flex-start;
665        padding-top: 0.5rem; 
666      }
667      
668      .right .values {
669        display: none;
670      }
671      .right .ratio-bar {
672        display: block;
673      }
674
675      .left {
676        gap: 8px;
677        width: 100%;
678        padding-right: 0;
679      }
680      
681      input[type="number"], input[type="date"], input[type="text"] { 
682        width: 100%; 
683        max-width: 100%;
684      }
685      
686      .input-line {
687        width: 100%;
688        margin-left: 0;
689        padding-top: 0;
690      }
691      
692      .apr {
693        padding-top: 0;
694      }
695      
696      .toolbar { 
697        flex-direction: column; 
698        align-items: flex-start;
699        justify-content: flex-start;
700        padding: 6px 24px;
701      }
702      
703      .financial-group {
704        flex-direction: column;
705        align-items: center;
706        width: 100%;
707      }
708      
709      #financial-summary {
710        font-size: 3.9rem;
711        padding-bottom: 8px;
712        width: 100%;
713        text-align: center;
714      }
715      
716      #interest-summary {
717        font-size: 1.95rem;
718        width: 100%;
719        text-align: center;
720        padding-bottom: 8px;
721      }
722    
723      .toolbar-controls {
724        justify-content: space-around;
725        width: 100%;
726      }
727      
728      .lastval, .name {
729        font-size: 2rem;
730      }
731      
732      /* v2.1: Slightly larger footer on mobile for readability */
733      footer, footer small, footer a, .security-notice {
734        font-size: 0.75rem;
735      }
736    }
737  </style>
738</head>
739<body>
740  <!-- Toast notification -->
741  <div id="toast" role="status" aria-live="polite"></div>
742  
743  <!-- Delete confirmation modal -->
744  <div id="delete-modal-backdrop" class="modal-backdrop"></div>
745  <div id="delete-modal" class="modal" role="alertdialog" aria-modal="true" aria-labelledby="delete-modal-title">
746    <h3 id="delete-modal-title">Delete Entry?</h3>
747    <p>Do you really want to delete this entry?</p>
748    <span id="delete-modal-details" class="modal-details"></span>
749    <div id="delete-modal-buttons" class="modal-buttons">
750      <button id="delete-btn-cancel">Cancel</button>
751      <button id="delete-btn-confirm">Yes, Delete</button>
752    </div>
753  </div>
754
755  <!-- Edit chip modal -->
756  <div id="edit-chip-modal-backdrop" class="modal-backdrop"></div>
757  <div id="edit-chip-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-chip-modal-title">
758    <h3 id="edit-chip-modal-title">Edit Entry</h3>
759    <div class="modal-form-group">
760      <label for="edit-chip-value">Value:</label>
761      <input type="number" id="edit-chip-value" step="0.01" placeholder="Enter value">
762    </div>
763    <div class="modal-form-group">
764      <label for="edit-chip-date">Date:</label>
765      <input type="date" id="edit-chip-date">
766    </div>
767    <span id="edit-chip-details" class="modal-details"></span>
768    <div id="edit-chip-buttons" class="modal-buttons">
769      <button id="edit-chip-delete">Delete</button>
770      <button id="edit-chip-cancel">Cancel</button>
771      <button id="edit-chip-save">Save</button>
772    </div>
773  </div>
774
775  <!-- Account menu modal -->
776  <div id="account-menu-modal-backdrop" class="modal-backdrop"></div>
777  <div id="account-menu-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="account-menu-modal-title">
778    <h3 id="account-menu-modal-title">Account Actions</h3>
779    <p id="account-menu-account-name" style="font-weight: 600; font-size: 1.2rem; margin-bottom: 1rem;"></p>
780    <div id="account-menu-buttons" class="modal-buttons">
781      <button id="account-menu-delete">üóëÔ∏è Delete Account</button>
782      <button id="account-menu-add">‚ûï Add New Account Below</button>
783      <button id="account-menu-cancel">Cancel</button>
784    </div>
785  </div>
786
787  <!-- Main header -->
788  <header>
789    <div class="toolbar">
790      <div class="financial-group">
791        <div id="financial-summary"></div>
792        <div id="interest-summary"></div>
793      </div>
794      
795      <div class="toolbar-controls">
796        <label for="timeframe">Timeframe:</label>
797        <select id="timeframe">
798          <option value="ytd" selected>This Calendar Year</option>
799          <option value="today">Today</option>
800          <option value="7d">Last 7 Days</option>
801          <option value="14d">Last 14 Days</option>
802          <option value="30d">Last 30 Days</option>
803          <option value="90d">Last 90 Days</option>
804          <option value="1y">Last Year (12mo)</option>
805          <option value="all">All Time</option>
806        </select>
807        
808        <label><input type="radio" name="mode" value="totals" checked> Totals</label>
809        <label><input type="radio" name="mode" value="accounts"> Per-account</label>
810        
811        <button id="refresh" aria-label="Refresh data">Refresh</button>
812        <button id="submitAll">Submit All</button>
813      </div>
814    </div>
815    
816    <div id="chart"></div>
817    
818    <!-- v2.0: Statusbar uses ‚ñë character -->
819    <section id="statusbar"></section>
820  </header>
821
822  <hr class="wrap divider">
823
824  <main class="wrap">
825    <section id="accounts" class="accounts"></section>
826    
827    <!-- v2.1: Tiny footer with security notice -->
828    <footer>
829      <div class="security-notice">
830        üîí <strong>Privacy First:</strong> No login credentials or personally identifiable 
831        information is stored in this application. All data resides in your Google Sheet. 
832        Your financial footprint, your control.
833      </div>
834      
835      <small>
836        <b>v2.1 Features:</b> Click chip to edit/delete ‚Ä¢ Long-press account name for menu ‚Ä¢ Filled chart visualization<br>
837        Enter values and press <b>Enter</b> or <b>Submit All</b> ‚Ä¢ Values shown as whole numbers
838      </small>
839    </footer>
840  </main>
841
842  <script>
843  /* ============================================
844     CONFIGURATION
845     ============================================ */
const API_BASE = 'https://script.google.com/macros/s/AKfycbwTGdC3eksqggTMAUtjcmmrCFBX_PGfLi_2_KkcLCDzXW8pYR9Uzum0c9UwfXPJvcM0Zw/exec';

/* ============================================/* ============================================/* ============================================/* ============================================/* ============================================/* ============================================

/* ============================================
    APPLICATION STATE
     ============================================
     Global variables for app state management.
  */
  let SNAP = null;              // Snapshot data from API
  let MODE = 'totals';          // Chart mode: 'totals' or 'accounts'
  let TIMEFRAME = 'ytd';        // Selected timeframe
  let IS_LOADING = false;       // Loading state flag
  let TOAST_TIMER = null;       // Toast auto-dismiss timer
     ============================================ */
  let SNAP = null;
  let MODE = 'totals';
  let TIMEFRAME = 'ytd';
  let IS_LOADING = false;
  let TOAST_TIMER = null;
  let LONG_PRESS_TIMER = null;
  const LONG_PRESS_DURATION = 500;

/* ============================================
    UI UTILITY FUNCTIONS
     ============================================
     Helper functions for user interface feedback.
  */
     ============================================ */

  /**
   * Display a toast notification
   * @param {string} msg - Message to display
   * @param {string} type - Type: 'info', 'success', or 'error'
   * @param {number} duration - Display duration in milliseconds
   */
function showToast(msg, type = 'info', duration = 3000) {
const el = document.getElementById('toast');
if (!el) return;

    // Clear existing timer
if (TOAST_TIMER) clearTimeout(TOAST_TIMER);

    // Set content and show
el.textContent = msg;
el.dataset.type = type;
el.classList.add('show');

    // Auto-dismiss after duration
TOAST_TIMER = setTimeout(() => el.classList.remove('show'), duration);
}

  /**
   * Set loading state for UI elements
   * @param {boolean} loading - Loading state
   * @param {string} message - Optional message to display
   */
function setLoading(loading, message) {
IS_LOADING = loading;

    // Disable/enable buttons
document.getElementById('refresh').disabled = loading;
document.getElementById('submitAll').disabled = loading;

    // Disable/enable all input fields
document.querySelectorAll('.row .left input[type="number"]').forEach(inp => {
inp.disabled = loading;
inp.classList.toggle('submitting', loading);
});

    // Show toast message if provided and modal isn't open
if (message && !document.getElementById('delete-modal-backdrop').classList.contains('show')) {
showToast(message, 'info', loading ? 10000 : 3000);
}
}

/* ============================================
    DELETE MODAL FUNCTIONS
     ============================================
     Handle deletion confirmation workflow.
  */
     ============================================ */

  /**
   * Show delete confirmation modal
   * @param {string} account - Account name
   * @param {string} date - Entry date
   * @param {number} value - Entry value
   * @param {string} readableValue - Formatted value for display
   */
function showDeleteConfirm(account, date, value, readableValue) {
if (IS_LOADING) return;

@@ -798,47 +1151,32 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
const details = document.getElementById('delete-modal-details');
const confirmBtn = document.getElementById('delete-btn-confirm');

    // Set modal content
details.textContent = `${account}: ${readableValue} on ${date}`;

    // Show modal
backdrop.classList.add('show');
modal.classList.add('show');

    // Bind confirm button
confirmBtn.onclick = () => processDelete(account, date, value);
}

  /**
   * Hide delete confirmation modal
   */
function hideDeleteConfirm() {
document.getElementById('delete-modal-backdrop').classList.remove('show');
document.getElementById('delete-modal').classList.remove('show');
}

  /**
   * Process entry deletion after confirmation
   * @param {string} account - Account name
   * @param {string} date - Entry date
   * @param {number} value - Entry value
   */
async function processDelete(account, date, value) {
hideDeleteConfirm();
if (IS_LOADING) return;
setLoading(true, 'Deleting entry‚Ä¶');

try {
      // Build API request
const body = new URLSearchParams({ 
payload: JSON.stringify({ account, date, value: Number(value) }) 
});

      // Send delete request
const res = await fetch(`${API_BASE}?route=delete`, { method: 'POST', body });
const text = await res.text();

      // Parse response
let j;
try { 
j = JSON.parse(text); 
@@ -849,15 +1187,13 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
return;
}

      // Check for errors
if (!j.ok) {
console.error('Delete JSON error:', j);
showToast(`Delete failed: ${j.error || 'Unknown'}`, 'error', 5000);
setLoading(false);
return;
}

      // Success - refresh data
showToast('Entry deleted. Refreshing‚Ä¶', 'success');
await fetchSnapshot();

@@ -868,67 +1204,199 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}
}

  /* ============================================
     EDIT CHIP MODAL FUNCTIONS
     ============================================ */
  
  function showEditChipModal(account, date, value, readableValue) {
    if (IS_LOADING) return;
    
    const backdrop = document.getElementById('edit-chip-modal-backdrop');
    const modal = document.getElementById('edit-chip-modal');
    const details = document.getElementById('edit-chip-details');
    const valueInput = document.getElementById('edit-chip-value');
    const dateInput = document.getElementById('edit-chip-date');
    const saveBtn = document.getElementById('edit-chip-save');
    const deleteBtn = document.getElementById('edit-chip-delete');
    
    details.textContent = `Account: ${account}`;
    valueInput.value = Number(value);
    
    const dateParts = date.split('/');
    if (dateParts.length === 3) {
      const [month, day, year] = dateParts;
      dateInput.value = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
    } else {
      dateInput.value = '';
    }
    
    backdrop.classList.add('show');
    modal.classList.add('show');
    
    setTimeout(() => valueInput.focus(), 100);
    
    saveBtn.onclick = () => processEditChip(account, date, value);
    deleteBtn.onclick = () => {
      hideEditChipModal();
      showDeleteConfirm(account, date, value, readableValue);
    };
  }
  
  function hideEditChipModal() {
    document.getElementById('edit-chip-modal-backdrop').classList.remove('show');
    document.getElementById('edit-chip-modal').classList.remove('show');
  }
  
  async function processEditChip(originalAccount, originalDate, originalValue) {
    if (IS_LOADING) return;
    
    const valueInput = document.getElementById('edit-chip-value');
    const dateInput = document.getElementById('edit-chip-date');
    
    const newValue = Number(valueInput.value);
    const newDateISO = dateInput.value;
    
    if (isNaN(newValue) || newValue === 0) {
      showToast('Please enter a valid non-zero value', 'error');
      return;
    }
    
    if (!newDateISO) {
      showToast('Please select a date', 'error');
      return;
    }
    
    const [year, month, day] = newDateISO.split('-');
    const newDate = `${parseInt(month)}/${parseInt(day)}/${year}`;
    
    hideEditChipModal();
    setLoading(true, 'Updating entry‚Ä¶');
    
    try {
      const deleteBody = new URLSearchParams({ 
        payload: JSON.stringify({ 
          account: originalAccount, 
          date: originalDate, 
          value: Number(originalValue) 
        }) 
      });
      
      const deleteRes = await fetch(`${API_BASE}?route=delete`, { method: 'POST', body: deleteBody });
      const deleteText = await deleteRes.text();
      const deleteJson = JSON.parse(deleteText);
      
      if (!deleteJson.ok) {
        throw new Error('Delete failed: ' + (deleteJson.error || 'Unknown'));
      }
      
      const submitBody = new URLSearchParams({ 
        payload: JSON.stringify({ 
          entries: [{ 
            account: originalAccount, 
            value: newValue,
            date: newDate
          }] 
        }) 
      });
      
      const submitRes = await fetch(`${API_BASE}?route=submit`, { method: 'POST', body: submitBody });
      const submitText = await submitRes.text();
      const submitJson = JSON.parse(submitText);
      
      if (!submitJson.ok) {
        throw new Error('Submit failed: ' + (submitJson.error || 'Unknown'));
      }
      
      showToast('Entry updated! Refreshing‚Ä¶', 'success');
      await fetchSnapshot();
      
    } catch (e) {
      console.error('Edit error:', e);
      setLoading(false);
      showToast('Failed to update entry: ' + e.message, 'error', 5000);
    }
  }

  /* ============================================
     ACCOUNT MENU MODAL
     ============================================ */
  
  function showAccountMenu(accountName) {
    if (IS_LOADING) return;
    
    const backdrop = document.getElementById('account-menu-modal-backdrop');
    const modal = document.getElementById('account-menu-modal');
    const accountNameEl = document.getElementById('account-menu-account-name');
    const deleteBtn = document.getElementById('account-menu-delete');
    const addBtn = document.getElementById('account-menu-add');
    
    accountNameEl.textContent = accountName;
    
    backdrop.classList.add('show');
    modal.classList.add('show');
    
    deleteBtn.onclick = () => {
      hideAccountMenu();
      showToast('Account deletion coming in v2.2!', 'info', 3000);
    };
    
    addBtn.onclick = () => {
      hideAccountMenu();
      showToast('Add account feature coming in v2.2!', 'info', 3000);
    };
  }
  
  function hideAccountMenu() {
    document.getElementById('account-menu-modal-backdrop').classList.remove('show');
    document.getElementById('account-menu-modal').classList.remove('show');
  }

/* ============================================
    DATA FETCHING
     ============================================
     Retrieve snapshot data from Google Apps Script API.
  */
     ============================================ */

  /**
   * Fetch account snapshot data from API
   * Includes error handling and validation
   */
async function fetchSnapshot() {
if (IS_LOADING) return;
setLoading(true, 'Loading snapshot‚Ä¶');

try {
      // Fetch data with cache-busting timestamp
const res = await fetch(`${API_BASE}?route=snapshot&ts=${Date.now()}&timeframe=${TIMEFRAME}`);
const text = await res.text();

      // Parse JSON response
let j;
try { 
j = JSON.parse(text); 
} catch {
        console.error('Non-JSON response (API issue):', text); 
        showToast('Error: API returned non-JSON. Check console for raw output.', 'error', 5000);
        console.error('Non-JSON response:', text); 
        showToast('Error: API returned non-JSON. Check console.', 'error', 5000);
setLoading(false);
return;
}

      // Validate response structure
if (!j.ok) {
        console.error('Snapshot error (j.ok is false):', j); 
        console.error('Snapshot error:', j); 
showToast('Error: ' + (j.error || 'snapshot failed'), 'error', 5000);
setLoading(false);
return;
}

      // Store snapshot and render
SNAP = j;
      console.log('--- Snapshot Data Loaded Successfully ---', SNAP); 
      console.log('Snapshot loaded:', SNAP); 

      setLoading(false, 'Snapshot loaded');
      setLoading(false);
renderAll();

} catch (err) {
      console.error('Fetch failed (network/pre-parse error):', err); 
      console.error('Fetch failed:', err); 
setLoading(false);
showToast('Fetch failed (see console)', 'error', 5000);
}
}

/* ============================================
    RENDERING FUNCTIONS
     ============================================
     Functions to update UI based on snapshot data.
  */
     ============================================ */

  /**
   * Master render function - calls all sub-renders
   */
function renderAll() {
renderSummary();
renderInterestSummary();
@@ -938,54 +1406,50 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}

/**
   * Render financial summary (Assets | Debts)
   * Displays total assets and debts from most recent data point
   * v2.1: Smart font weight logic
   * Only the larger absolute value gets bold
  */
function renderSummary() {
const summaryEl = document.getElementById('financial-summary');
if (!summaryEl || !SNAP || !SNAP.totals || !SNAP.dateAxis) return;

const lastIndex = SNAP.dateAxis.length - 1;

    // Handle empty data
if (lastIndex < 0) {
summaryEl.innerHTML = 'No Data';
return;
}

    // Get most recent totals
const assets = Number(SNAP.totals.assets?.[lastIndex]) || 0;
    const debts = Math.abs(Number(SNAP.totals.debts?.[lastIndex]) || 0); 
    const debtsRaw = Number(SNAP.totals.debts?.[lastIndex]) || 0;
    const debts = Math.abs(debtsRaw);

    // Format with color coding
    const assetString = `<span class="summary-asset">${formatMoney(assets)}</span>`;
    const debtString = `<span class="summary-debt">${formatMoney(debts)}</span>`;
    // v2.1: Determine which absolute value is larger
    const assetClass = assets > debts ? 'bold-value' : '';
    const debtClass = debts > assets ? 'bold-value' : '';
    // If equal, neither gets bold (both stay light)
    
    const assetString = `<span class="summary-asset ${assetClass}">${formatMoney(assets)}</span>`;
    const debtString = `<span class="summary-debt ${debtClass}">${formatMoney(debts)}</span>`;

summaryEl.innerHTML = `${assetString} <span style="font-weight: 300;">|</span> ${debtString}`;
}

  /**
   * Render interest summary (Total earnings | Total costs)
   * Calculates aggregate interest across all accounts for selected timeframe
   */
function renderInterestSummary() {
const summaryEl = document.getElementById('interest-summary');
if (!summaryEl || !SNAP || !SNAP.accounts) return;

    let totalEarnings = 0;  // Interest earned on positive balances
    let totalCosts = 0;     // Interest paid on negative balances
    let totalEarnings = 0;
    let totalCosts = 0;
let periodLabel = '';

    // Calculate interest for each account
SNAP.accounts.forEach(a => {
const s = SNAP.series[a.name] || {};
const last = s?.last ?? 0;
const apr = a.apr || 0;

      // Skip if no APR or zero balance
if (apr === 0 || last === 0) return;

      // Calculate interest based on timeframe
const dailyRate = (last * apr) / 365;
let interestAmount = 0;

@@ -1018,21 +1482,18 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
break;
}

      // Accumulate earnings (positive interest) or costs (negative interest)
if (interestAmount > 0) {
totalEarnings += interestAmount;
} else {
        totalCosts += interestAmount;  // Already negative
        totalCosts += interestAmount;
}
});

    // Only display if there's meaningful interest (threshold: $0.01)
if (Math.abs(totalEarnings) < 0.01 && Math.abs(totalCosts) < 0.01) {
summaryEl.innerHTML = '';
return;
}

    // Format the display
const earningsStr = totalEarnings >= 0.01 
? `<span class="interest-earned">+${formatMoney(totalEarnings)}${periodLabel}</span>` 
: '';
@@ -1041,7 +1502,6 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
? `<span class="interest-cost">${formatMoney(totalCosts)}${periodLabel}</span>` 
: '';

    // Build display with separator if both exist
let displayParts = [];
if (earningsStr) displayParts.push(earningsStr);
if (costsStr) displayParts.push(costsStr);
@@ -1053,115 +1513,55 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}
}

  /**
   * Render global statusbar (100-block asset/debt ratio)
   * Visual representation of financial balance
   * LEFT (Green ‚Ö°) = Assets (positive, 0 and above)
   * RIGHT (Red ‚Ö°) = Debts (negative, below 0)
   */
function renderStatusbar() {
    console.log('renderStatusbar() called');
    
const statusbarEl = document.getElementById('statusbar');
    if (!statusbarEl) {
      console.error('statusbar element not found!');
      return;
    }
    
    if (!SNAP || !SNAP.totals || !SNAP.dateAxis) {
      console.log('Missing SNAP data:', { SNAP, hasTotals: !!SNAP?.totals, hasDateAxis: !!SNAP?.dateAxis });
      return;
    }
    if (!statusbarEl || !SNAP || !SNAP.totals || !SNAP.dateAxis) return;

const lastIndex = SNAP.dateAxis.length - 1;

    // Handle empty data
if (lastIndex < 0) {
      console.log('No data points in dateAxis');
statusbarEl.innerHTML = '';
return;
}

    // Calculate asset and debt totals
    // Assets are positive (0 and above), debts are negative (below 0)
const assets = Number(SNAP.totals.assets?.[lastIndex]) || 0;
const debtsRaw = Number(SNAP.totals.debts?.[lastIndex]) || 0;
    const debts = Math.abs(debtsRaw);  // Convert negative debt to positive for calculation
    const debts = Math.abs(debtsRaw);
const total = assets + debts;

    console.log('Raw values from SNAP:', {
      lastIndex,
      assetsRaw: SNAP.totals.assets?.[lastIndex],
      debtsRaw: SNAP.totals.debts?.[lastIndex],
      assets,
      debts,
      total
    });
    
    // Handle zero total (all green as default, 0 is treated as positive)
if (total === 0) {
      statusbarEl.innerHTML = '<span class="status-positive">' + '‚Ö°'.repeat(100) + '</span>';
      statusbarEl.innerHTML = '<span class="status-positive">' + '‚ñë'.repeat(100) + '</span>';
return;
}

    // Calculate proportional blocks (100 total)
const totalBlocks = 100;
const assetBlocks = Math.round((assets / total) * totalBlocks);
const debtBlocks = totalBlocks - assetBlocks;

    // Debug logging
    console.log('Statusbar calculation:', {
      assets,
      debts,
      total,
      assetBlocks,
      debtBlocks,
      assetPercentage: ((assets / total) * 100).toFixed(1) + '%',
      debtPercentage: ((debts / total) * 100).toFixed(1) + '%'
    });
    
    // Generate block strings using ‚Ö° character
    const assetBar = '‚Ö°'.repeat(assetBlocks);
    const debtBar = '‚Ö°'.repeat(debtBlocks);
    const assetBar = '‚ñë'.repeat(assetBlocks);
    const debtBar = '‚ñë'.repeat(debtBlocks);

    console.log('Block counts:', {
      assetBarLength: assetBar.length,
      debtBarLength: debtBar.length,
      total: assetBar.length + debtBar.length
    });
    
    // Render: GREEN (positive/assets) FIRST on LEFT, then RED (negative/debts) on RIGHT
    // LEFT = Positive (0+) = Green #4c8036
    // RIGHT = Negative (<0) = Red #a02d2a
    const html = `<span class="status-positive">${assetBar}</span><span class="status-negative">${debtBar}</span>`;
    console.log('Setting statusbar HTML, length:', html.length);
    statusbarEl.innerHTML = html;
    
    console.log('Statusbar rendered successfully');
    statusbarEl.innerHTML = `<span class="status-positive">${assetBar}</span><span class="status-negative">${debtBar}</span>`;
}

/**
   * Render Google Charts visualization
   * Shows either total assets/debts or per-account trends
   * v2.1: Render chart with filled areas (stacked)
  */
function renderChart() {
if (!SNAP || !window.google || !google.visualization) return;

const labels = SNAP.dateAxis; 

    // Handle empty data
if (!labels || labels.length === 0) {
document.getElementById('chart').innerHTML = '<div style="text-align:center; padding-top: 20px; color: #888;">No data for this timeframe.</div>';
return;
}

    // Build data table
const data = new google.visualization.DataTable();
data.addColumn('string', 'Date'); 
let rows = [];

if (MODE === 'totals') {
      // Totals mode: Show aggregated assets vs debts
data.addColumn('number', 'Assets');
data.addColumn('number', 'Debts');
const assets = SNAP.totals?.assets || [];
@@ -1171,7 +1571,6 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
rows.push([labels[i], Number(assets[i] || 0), Number(debts[i] || 0)]);
}
} else {
      // Per-account mode: Show individual account trends
SNAP.accounts.forEach(a => data.addColumn('number', a.name));
for (let i = 0; i < labels.length; i++) {
const row = [labels[i]]; 
@@ -1184,7 +1583,6 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}
data.addRows(rows);

    // Calculate axis bounds
let minV = 0, maxV = 0;
for (const r of rows) {
for (let i = 1; i < r.length; i++) {
@@ -1195,17 +1593,17 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}
const maxAbs = Math.max(Math.abs(minV), Math.abs(maxV), 100);

    // Get theme colors from CSS
const styles = getComputedStyle(document.documentElement);
const pos = styles.getPropertyValue('--c-pos').trim();
const neg = styles.getPropertyValue('--c-neg').trim();
const black = styles.getPropertyValue('--c-black').trim();
const textStyle = { color: black, fontName: 'system-ui' };

    // Set chart colors based on mode
    let chartColors = MODE === 'totals' ? [pos, neg] : SNAP.accounts.map(a => a.color || null);
    let chartColors = MODE === 'totals' 
      ? [pos, neg] 
      : SNAP.accounts.map(a => a.color || '#999999');

    // Chart options
    // v2.1: Area chart with stacking
const options = {
height: Math.max(240, Math.round(window.innerHeight * 0.30)),
backgroundColor: { fill: 'transparent' },
@@ -1223,57 +1621,41 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
gridlines: { color: black, opacity: 0.1 },
textStyle: textStyle
},
      seriesType: 'line',
      lineWidth: 3,
      seriesType: 'area',      // v2.1: Changed from 'line'
      isStacked: true,          // v2.1: Enable stacking
      areaOpacity: 0.75,        // v2.1: Solid fill with slight transparency
      lineWidth: 2,             // v2.1: Thinner lines
colors: chartColors
};

    // Draw chart
const chart = new google.visualization.ComboChart(document.getElementById('chart'));
chart.draw(data, options);
}

  /**
   * Determine sign class for value (pos/neg)
   * @param {number} n - Number to evaluate
   * @returns {string} 'neg' or 'pos'
   */
const signOf = (n) => (Number(n) < 0 ? 'neg' : 'pos');

  /**
   * Format number as money (truncated to whole dollars)
   * @param {number} n - Number to format
   * @returns {string} Formatted money string (e.g., "$1,234" or "‚àí$5,678")
   */
function formatMoney(n) {
const val = Number(n) || 0;
    const sign = val < 0 ? '‚àí' : '';  // Use proper minus sign
    const sign = val < 0 ? '‚àí' : '';
const abs = Math.abs(val);
    const displayValue = Math.trunc(abs);  // Truncate to whole number
    const displayValue = Math.trunc(abs);

return `${sign}${displayValue.toLocaleString(undefined, { 
       minimumFractionDigits: 0, 
       maximumFractionDigits: 0 
   })}`;
}

  /**
   * Render all account rows with details, inputs, and history
   * Main rendering function for account list
   */
function renderAccounts() {
const root = document.getElementById('accounts');
root.innerHTML = '';

    // Safety check
if (!SNAP || !SNAP.accounts) return;

    // Render each account
SNAP.accounts.forEach(a => {
const s = SNAP.series[a.name] || {};
      const last = s?.last ?? 0;  // Current account balance
      const last = s?.last ?? 0;

      // Create row container
const row = document.createElement('div');
row.className = 'row';

@@ -1283,43 +1665,70 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
const right = document.createElement('div');
right.className = 'right';

      // ===== LEFT SIDE: Account Details =====
const accountDetails = document.createElement('div');
accountDetails.className = 'account-details';

      // Balance and name container
const identityWrap = document.createElement('div');
identityWrap.style.cssText = 'display:flex; align-items:baseline; gap:10px; flex-wrap:nowrap; min-width:0';

      // Current balance (large display)
const lastEl = document.createElement('span');
lastEl.className = 'lastval';
lastEl.textContent = formatMoney(last); 
lastEl.dataset.sign = signOf(last);

      // Account name
const nameEl = document.createElement('span');
nameEl.className = 'name';
nameEl.textContent = a.name;
if (a.color) nameEl.style.color = a.color;

      // Long-press handlers
      let pressStartTime = 0;
      
      nameEl.addEventListener('mousedown', (e) => {
        pressStartTime = Date.now();
        LONG_PRESS_TIMER = setTimeout(() => {
          showAccountMenu(a.name);
        }, LONG_PRESS_DURATION);
      });
      
      nameEl.addEventListener('mouseup', (e) => {
        if (LONG_PRESS_TIMER) {
          clearTimeout(LONG_PRESS_TIMER);
        }
      });
      
      nameEl.addEventListener('mouseleave', (e) => {
        if (LONG_PRESS_TIMER) {
          clearTimeout(LONG_PRESS_TIMER);
        }
      });
      
      nameEl.addEventListener('touchstart', (e) => {
        pressStartTime = Date.now();
        LONG_PRESS_TIMER = setTimeout(() => {
          showAccountMenu(a.name);
        }, LONG_PRESS_DURATION);
      });
      
      nameEl.addEventListener('touchend', (e) => {
        if (LONG_PRESS_TIMER) {
          clearTimeout(LONG_PRESS_TIMER);
        }
      });
      
identityWrap.appendChild(lastEl);
identityWrap.appendChild(nameEl);

      // ===== APR DISPLAY WITH INTEREST CALCULATION =====
const aprEl = document.createElement('span');
aprEl.className = 'apr';

      // Calculate interest based on selected timeframe
const apr = a.apr || 0;
let interestAmount = 0;
let periodLabel = '';

if (apr > 0 && last !== 0) {
        // Calculate daily interest rate
const dailyRate = (last * apr) / 365;

        // Map timeframe to period and calculate interest
switch(TIMEFRAME) {
case 'today':
interestAmount = dailyRate * 1;
@@ -1350,14 +1759,10 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}
}

      // Build APR display HTML
let aprHTML = `APR: ${(apr * 100).toFixed(2)}%`;

      // Add interest calculation if non-zero (threshold: $0.01)
      // For debt accounts (negative balance), interest will be negative
      // For savings accounts (positive balance), interest will be positive
if (Math.abs(interestAmount) >= 0.01) {
        const sign = interestAmount >= 0 ? '+' : '';  // Sign already in value for negatives
        const sign = interestAmount >= 0 ? '+' : '';
const color = interestAmount >= 0 ? 'var(--c-pos)' : 'var(--c-neg)';
aprHTML += `<br><span style="color: ${color}">${sign}${formatMoney(interestAmount)}${periodLabel}</span>`;
}
@@ -1367,18 +1772,16 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
accountDetails.appendChild(identityWrap);
accountDetails.appendChild(aprEl);

      // ===== INPUT FIELD FOR NEW VALUES =====
const inputLine = document.createElement('div');
inputLine.className = 'input-line';

const inp = document.createElement('input');
inp.type = 'number';
inp.placeholder = 'Add new value‚Ä¶';
      inp.step = '0.01';  // Allow decimal input
      inp.step = '0.01';
inp.setAttribute('aria-label', `New value for ${a.name}`);
inp.dataset.accountName = a.name;

      // Tint background based on account type
if (last > 0) {
inp.style.backgroundColor = 'var(--c-tint-pos)';
} else if (last < 0) {
@@ -1387,7 +1790,6 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
inp.style.backgroundColor = 'var(--c-white)';
}

      // Submit on Enter key
inp.addEventListener('keydown', async (ev) => {
if (ev.key === 'Enter') {
await submitEntries([{ account: a.name, value: inp.value, inputEl: inp }]);
@@ -1398,11 +1800,9 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
left.appendChild(accountDetails);
left.appendChild(inputLine);

      // ===== RIGHT SIDE: Historical Values (Chips) =====
const vals = document.createElement('div');
vals.className = 'values';

      // Render historical value chips
(s.lastN || []).forEach(v => {
const isObject = (typeof v === 'object' && v !== null && v.value !== undefined);
const val = Number(isObject ? v.value : v);
@@ -1414,33 +1814,25 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
chip.className = 'chip';
chip.dataset.sign = signOf(val);
chip.textContent = readableValue;
        chip.dataset.value = val;  // Store full decimal value
        chip.dataset.value = val;

if (date) {
          // Deletable chip (has date metadata)
chip.dataset.date = date;
chip.dataset.account = a.name;
          chip.dataset.readableValue = formatMoney(val);
          chip.dataset.readableValue = readableValue;

          // Multiple deletion triggers
          chip.addEventListener('dblclick', handleDeleteClick);
          chip.addEventListener('contextmenu', handleDeleteClick);
chip.addEventListener('click', (e) => {
            if (e.shiftKey || e.ctrlKey || e.altKey) {
              handleDeleteClick(e);
            }
            showEditChipModal(a.name, date, val, readableValue);
});
} else {
          // Non-deletable chip (old data format)
chip.classList.add('no-delete');
          chip.title = "Re-deploy CODE.JS to enable deletion";
          chip.title = "Old data format - re-deploy CODE.JS";
}

vals.appendChild(chip);
});
right.appendChild(vals);

      // ===== MOBILE RATIO BAR (Proportional) =====
const bar = document.createElement('h4');
bar.className = 'ratio-bar';

@@ -1450,29 +1842,23 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
const debtSpan = document.createElement('span');
debtSpan.style.color = 'var(--c-neg)';

      // Calculate proportional blocks based on account's share of category
const lastIndex = SNAP.dateAxis.length - 1;
const totalAssets = Number(SNAP.totals.assets?.[lastIndex]) || 0;
const totalDebtsRaw = Number(SNAP.totals.debts?.[lastIndex]) || 0;
const totalDebts = Math.abs(totalDebtsRaw);

if (last >= 0 && totalAssets > 0) {
        // Asset account: show proportion of total assets
const percentage = (last / totalAssets) * 100;
        // 5% threshold: only show if >= 5%, minimum 1 block
const blocks = percentage >= 5 ? Math.max(1, Math.round((last / totalAssets) * 10)) : 0;
assetSpan.textContent = '‚ñë'.repeat(blocks);
debtSpan.textContent = '';
} else if (last < 0 && totalDebts > 0) {
        // Debt account: show proportion of total debts
const absLast = Math.abs(last);
const percentage = (absLast / totalDebts) * 100;
        // 5% threshold: only show if >= 5%, minimum 1 block
const blocks = percentage >= 5 ? Math.max(1, Math.round((absLast / totalDebts) * 10)) : 0;
assetSpan.textContent = '';
        debtSpan.textContent = '‚ñà'.repeat(blocks);
        debtSpan.textContent = '‚ñë'.repeat(blocks);
} else {
        // Edge case: zero balance or no category total
assetSpan.textContent = '';
debtSpan.textContent = '';
}
@@ -1481,47 +1867,19 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
bar.appendChild(debtSpan);
right.appendChild(bar);

      // Assemble row
row.appendChild(left);
row.appendChild(right);
root.appendChild(row);
});
}
  
  /**
   * Handle delete click on value chip
   * @param {Event} e - Click event
   */
  function handleDeleteClick(e) {
    e.preventDefault();
    if (IS_LOADING) return;
    
    const chip = e.currentTarget;
    const { account, date, value, readableValue } = chip.dataset;
    
    // Check if deletion is supported (needs date metadata)
    if (!date) {
      showToast('Cannot delete. Data is from an older script version.', 'error');
      return;
    }
    
    showDeleteConfirm(account, date, value, readableValue);
  }

/* ============================================
     DATA SUBMISSION FUNCTIONS
     ============================================
     Handle submitting new account values to API.
  */
     DATA SUBMISSION
     ============================================ */

  /**
   * Submit all entered values across all accounts
   * Triggered by "Submit All" button
   */
async function submitAll() {
const entries = [];

    // Collect all non-empty inputs
document.querySelectorAll('.row .left input[type="number"]').forEach(inp => {
const v = inp.value.trim();
if (v !== '') {
@@ -1533,7 +1891,6 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}
});

    // Validate we have entries
if (entries.length === 0) {
showToast('No values entered to submit.', 'info');
return;
@@ -1542,19 +1899,13 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
await submitEntries(entries);
}

  /**
   * Submit array of entries to API
   * @param {Array} entries - Array of {account, value, inputEl} objects
   */
async function submitEntries(entries) {
if (IS_LOADING) return;
setLoading(true, 'Submitting entries‚Ä¶');

    // Mark inputs as submitting
entries.forEach(e => e.inputEl?.classList.add('submitting'));

try {
      // Build valid entries payload
const validEntries = entries
.map(e => ({ account: e.account, value: e.value }))
.filter(e => e.account && !isNaN(e.value));
@@ -1566,14 +1917,12 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
return;
}

      // Send to API
const body = new URLSearchParams({ 
payload: JSON.stringify({ entries: validEntries }) 
});
const res = await fetch(`${API_BASE}?route=submit`, { method: 'POST', body });
const text = await res.text();

      // Parse response
let j;
try { 
j = JSON.parse(text); 
@@ -1585,7 +1934,6 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
return;
}

      // Check for errors
if (!j.ok) {
console.error('Submit JSON error:', j);
showToast('Submit failed: ' + (j.error || 'Unknown'), 'error', 5000);
@@ -1594,15 +1942,13 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
return;
}

      // Success!
      showToast('Submit successful! Refreshing data‚Ä¶', 'success');
      showToast('Submit successful! Refreshing‚Ä¶', 'success');
entries.forEach(e => {
e.inputEl?.classList.add('submitted-ok');
        e.inputEl.value = '';  // Clear input
        e.inputEl.value = '';
setTimeout(() => e.inputEl?.classList.remove('submitted-ok'), 800);
});

      // Refresh data
await fetchSnapshot();

} catch (e) {
@@ -1616,37 +1962,35 @@ <h3 id="delete-modal-title" style="margin-top:0;">Delete Entry?</h3>
}

/* ============================================
     INITIALIZATION & EVENT BINDING
     ============================================
     Set up event listeners and load initial data.
  */
     INITIALIZATION
     ============================================ */
document.addEventListener('DOMContentLoaded', () => {
    // Bind button clicks
document.getElementById('refresh').addEventListener('click', fetchSnapshot);
document.getElementById('submitAll').addEventListener('click', submitAll);

    // Bind chart mode toggle
document.querySelectorAll('input[name="mode"]').forEach(r => {
r.addEventListener('change', (e) => { 
MODE = e.target.value; 
        renderChart();  // Re-render chart with new mode
        renderChart();
});
});

    // Bind timeframe selector
document.getElementById('timeframe').addEventListener('change', (e) => {
TIMEFRAME = e.target.value;
      fetchSnapshot();  // Fetch new data for timeframe
      fetchSnapshot();
});

    // Bind modal controls
document.getElementById('delete-btn-cancel').addEventListener('click', hideDeleteConfirm);
document.getElementById('delete-modal-backdrop').addEventListener('click', hideDeleteConfirm);

    // Bind window resize to re-render chart
    document.getElementById('edit-chip-cancel').addEventListener('click', hideEditChipModal);
    document.getElementById('edit-chip-modal-backdrop').addEventListener('click', hideEditChipModal);
    
    document.getElementById('account-menu-cancel').addEventListener('click', hideAccountMenu);
    document.getElementById('account-menu-modal-backdrop').addEventListener('click', hideAccountMenu);
    
window.addEventListener('resize', renderChart);

    // Load Google Charts library and fetch initial data
if (window.google && google.charts) {
google.charts.load('current', { packages: ['corechart'] });
google.charts.setOnLoadCallback(fetchSnapshot);
