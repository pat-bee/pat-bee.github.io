<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio — Electric Ice Brief</title>

  <!--
    Minimalist “electric ice / synthwave clinic” theme:
    - Cool cyan + soft magenta accents
    - Very clean typography
    - Subtle glow + glassy panels
  -->
  <style>
    :root{
      --bg0:#060813;
      --bg1:#071225;
      --panel:#0b1630cc;         /* translucent panel */
      --stroke:#1a2f55;          /* panel border */
      --text:#e8f2ff;            /* main text */
      --muted:#a9bedc;           /* secondary text */
      --ice:#76f3ff;             /* electric ice cyan */
      --wave:#ff4fd8;            /* synthwave magenta */
      --ok:#8affc1;              /* “good” */
      --warn:#ffd17a;            /* “warning” */
      --bad:#ff6b86;             /* “bad” */
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    /* Page background: dark ice gradient with subtle scanline vibe */
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(118,243,255,.18), transparent 60%),
        radial-gradient(1000px 800px at 90% 10%, rgba(255,79,216,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      letter-spacing: .1px;
    }
    /* Subtle “clinic lighting” grid */
    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        linear-gradient(to bottom, rgba(255,255,255,.045) 1px, transparent 1px),
        linear-gradient(to right, rgba(255,255,255,.03) 1px, transparent 1px);
      background-size: 56px 56px;
      opacity:.18;
      mix-blend-mode: overlay;
    }

    a{ color: var(--ice); text-decoration: none; }
    a:hover{ text-decoration: underline; }

    /* Layout container — intentionally similar to many Apps Script “single-pane” tools */
    .wrap{
      max-width: 1180px;
      margin: 22px auto 70px;
      padding: 0 16px;
    }

    /* Top bar */
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 14px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap: 4px;
    }
    .brand h1{
      font-size: 18px;
      font-weight: 700;
      margin:0;
      letter-spacing:.3px;
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
      font-family: var(--mono);
    }

    /* Buttons */
    .btn{
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(118,243,255,.12), rgba(118,243,255,.05));
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 650;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transition: transform .06s ease, box-shadow .18s ease, border-color .18s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{
      border-color: rgba(118,243,255,.55);
      box-shadow: 0 0 24px rgba(118,243,255,.10);
    }
    .btn:active{ transform: translateY(1px); }

    /* KPI panel */
    .panel{
      background: var(--panel);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .kpis{
      padding: 16px 16px 14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr .9fr;
      gap: 12px;
    }
    .kpi{
      border: 1px solid rgba(118,243,255,.14);
      border-radius: 16px;
      padding: 12px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .kpi .label{
      font-size: 11px;
      color: var(--muted);
      font-family: var(--mono);
      letter-spacing:.25px;
      margin-bottom: 8px;
    }
    .kpi .value{
      font-size: 22px;
      font-weight: 800;
      letter-spacing:.2px;
    }
    .kpi .hint{
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
      font-family: var(--mono);
    }
    .ice{
      color: var(--ice);
      text-shadow: 0 0 18px rgba(118,243,255,.20);
    }
    .wave{
      color: var(--wave);
      text-shadow: 0 0 18px rgba(255,79,216,.16);
    }

    /* Table */
    .tableWrap{
      margin-top: 14px;
      padding: 10px 10px 14px;
    }
    table{
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
      border-radius: 14px;
    }
    thead th{
      text-align:left;
      font-size: 11px;
      color: var(--muted);
      font-family: var(--mono);
      font-weight: 700;
      letter-spacing:.25px;
      padding: 10px 10px;
      border-bottom: 1px solid rgba(118,243,255,.14);
      background: rgba(8,18,40,.65);
      position: sticky;
      top: 0; /* nice for long list */
      z-index: 1;
    }
    tbody td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(118,243,255,.08);
      vertical-align: top;
      font-size: 13px;
      line-height: 1.25;
    }
    tbody tr:hover{
      background: rgba(118,243,255,.04);
    }
    .mono{ font-family: var(--mono); }
    .muted{ color: var(--muted); }
    .right{ text-align:right; }
    .nowrap{ white-space:nowrap; }

    /* Row status badges */
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-family: var(--mono);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      white-space: nowrap;
    }
    .b-ok{ border-color: rgba(138,255,193,.35); color: var(--ok); }
    .b-warn{ border-color: rgba(255,209,122,.38); color: var(--warn); }
    .b-bad{ border-color: rgba(255,107,134,.38); color: var(--bad); }

    /* Footer note */
    .foot{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
      font-family: var(--mono);
      padding: 0 4px;
    }

    /* Mobile adjustments */
    @media (max-width: 920px){
      .kpis{ grid-template-columns: 1fr; }
      thead{ display:none; }
      table, tbody, tr, td{ display:block; width:100%; }
      tbody td{
        border-bottom: none;
        padding: 8px 10px;
      }
      tbody tr{
        border: 1px solid rgba(118,243,255,.10);
        border-radius: 14px;
        margin: 10px 0;
        overflow:hidden;
        background: rgba(8,18,40,.35);
      }
      tbody td[data-label]::before{
        content: attr(data-label);
        display:block;
        font-size: 11px;
        color: var(--muted);
        font-family: var(--mono);
        margin-bottom: 4px;
      }
      .right{ text-align:left; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>Portfolio Snapshot — Electric Ice</h1>
        <div class="sub">Live valuation on refresh · Whole-share holdings · Minimal, clinical synthwave theme</div>
      </div>
      <button class="btn" id="refreshBtn" title="Re-fetch prices and recompute totals">Refresh Prices</button>
    </div>

    <section class="panel kpis" aria-label="Portfolio key performance indicators">
      <div class="kpi">
        <div class="label">TOTAL PORTFOLIO VALUE (LIVE)</div>
        <div class="value ice" id="totalValue">$—</div>
        <div class="hint" id="lastUpdated">Last updated: —</div>
      </div>
      <div class="kpi">
        <div class="label">POSITIONS LOADED / PRICED</div>
        <div class="value wave" id="pricedCount">— / —</div>
        <div class="hint">Some OTC/ADR symbols may return N/A from free sources</div>
      </div>
      <div class="kpi">
        <div class="label">DATA SOURCE</div>
        <div class="value" style="font-size:16px; font-weight:800;">
          Stooq CSV via r.jina.ai
        </div>
        <div class="hint">No API key required; values use latest available close per symbol</div>
      </div>
    </section>

    <section class="panel tableWrap" aria-label="Portfolio detail table">
      <table>
        <thead>
          <tr>
            <th style="width: 18%;">Company</th>
            <th style="width: 8%;">Ticker</th>
            <th style="width: 6%;" class="right">Shares</th>
            <th style="width: 10%;" class="right">Price</th>
            <th style="width: 12%;" class="right">Position Value</th>
            <th style="width: 6%;" class="right">Ethics</th>
            <th style="width: 14%;">CEO</th>
            <th>Headline (linked search)</th>
            <th style="width: 8%;">Status</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>

      <div class="foot">
        Notes: (1) Ticker links go to Google Finance. (2) CEO links are Google searches. (3) Headline links are Google News searches.
        (4) This page computes value from the latest quote returned; it is not a brokerage statement.
      </div>
    </section>
  </div>

  <script>
    /**
     * ===========================
     *  PORTFOLIO CONFIG (EXACT)
     * ===========================
     * This is your exact master list (25 tickers) and the exact whole-share holdings
     * implied by the prior allocation logic.
     *
     * Ethics score is your values-spectrum: 1 = "pure evil capitalist doom"
     * and 10 = "pure altruistic humanitarian/planet wellbeing".
     *
     * Headlines here are simple strings used only to generate a Google News search.
     * You can replace any line with a headline you prefer.
     */

    const PORTFOLIO = [
      // Water / waste / logistics
      { name:"Xylem", ticker:"XYL", exchange:"NYSE", shares:1, ethics:9, home:"https://www.xylem.com", ceo:"Matthew Pine",
        headline:"Xylem raises outlook on strong demand for water solutions" },

      { name:"Waste Management", ticker:"WM", exchange:"NYSE", shares:1, ethics:7, home:"https://www.wm.com", ceo:"Jim Fish",
        headline:"Waste Management beats estimates on higher pricing" },

      { name:"CSX", ticker:"CSX", exchange:"NASDAQ", shares:1, ethics:6, home:"https://www.csx.com", ceo:"Joe Hinrichs",
        headline:"CSX reports quarterly results amid intermodal demand focus" },

      // Electrification / grid / efficiency
      { name:"Eaton", ticker:"ETN", exchange:"NYSE", shares:5, ethics:8, home:"https://www.eaton.com", ceo:"Craig Arnold",
        headline:"Eaton highlights data center and electrification demand" },

      { name:"Quanta Services", ticker:"PWR", exchange:"NYSE", shares:1, ethics:8, home:"https://www.quantaservices.com", ceo:"Duke Austin",
        headline:"Quanta Services lifts forecast on power infrastructure work" },

      { name:"Hubbell", ticker:"HUBB", exchange:"NYSE", shares:1, ethics:7, home:"https://www.hubbell.com", ceo:"Gerben Bakker",
        headline:"Hubbell boosts outlook tied to electrical segment demand" },

      { name:"Johnson Controls", ticker:"JCI", exchange:"NYSE", shares:1, ethics:8, home:"https://www.johnsoncontrols.com", ceo:"Joakim Weidemanis",
        headline:"Johnson Controls updates profit outlook on building systems demand" },

      { name:"Trane Technologies", ticker:"TT", exchange:"NYSE", shares:1, ethics:7, home:"https://www.tranetechnologies.com", ceo:"Dave Regnery",
        headline:"Trane raises guidance on resilient HVAC demand" },

      { name:"Carrier Global", ticker:"CARR", exchange:"NYSE", shares:1, ethics:6, home:"https://www.carrier.com", ceo:"David Gitlin",
        headline:"Carrier discusses investments and HVAC demand trends" },

      { name:"Daikin Industries", ticker:"DKILY", exchange:"OTCMKTS", shares:1, ethics:6, home:"https://www.daikin.com", ceo:"Masatoshi Nakane",
        headline:"Daikin focuses on efficiency and heat-pump growth" },

      { name:"ABB", ticker:"ABBNY", exchange:"OTCMKTS", shares:1, ethics:7, home:"https://global.abb", ceo:"Morten Wierod",
        headline:"ABB updates profitability goals amid electrification demand" },

      { name:"Nextracker", ticker:"NXT", exchange:"NASDAQ", shares:3, ethics:9, home:"https://www.nextracker.com", ceo:"Dan Shugar",
        headline:"Nextracker reports results as utility-scale solar demand evolves" },

      // Semiconductors / enablers
      { name:"Texas Instruments", ticker:"TXN", exchange:"NASDAQ", shares:1, ethics:5, home:"https://www.ti.com", ceo:"Haviv Ilan",
        headline:"Texas Instruments outlook reflects analog and industrial cycle" },

      // Health / reduce suffering
      { name:"Eli Lilly", ticker:"LLY", exchange:"NYSE", shares:2, ethics:7, home:"https://www.lilly.com", ceo:"David Ricks",
        headline:"Eli Lilly expands manufacturing to meet diabetes and obesity demand" },

      { name:"Intuitive Surgical", ticker:"ISRG", exchange:"NASDAQ", shares:2, ethics:8, home:"https://www.intuitive.com", ceo:"Gary Guthart",
        headline:"Intuitive Surgical posts results as procedure growth continues" },

      { name:"Thermo Fisher Scientific", ticker:"TMO", exchange:"NYSE", shares:1, ethics:7, home:"https://www.thermofisher.com", ceo:"Marc Casper",
        headline:"Thermo Fisher discusses demand trends in life sciences tools" },

      // Housing affordability
      { name:"Cavco Industries", ticker:"CVCO", exchange:"NASDAQ", shares:1, ethics:7, home:"https://www.cavco.com", ceo:"Bill Boor",
        headline:"Cavco reports results amid manufactured housing demand" },

      // Rare earths (strategic + extraction tradeoffs)
      { name:"MP Materials", ticker:"MP", exchange:"NYSE", shares:11, ethics:5, home:"https://mpmaterials.com", ceo:"James Litinsky",
        headline:"MP Materials updates strategy on rare earths processing and supply chains" },

      { name:"Lynas Rare Earths", ticker:"LYSCF", exchange:"OTCMKTS", shares:1, ethics:6, home:"https://lynasrareearths.com", ceo:"Amanda Lacaze",
        headline:"Lynas advances rare earths supply diversification initiatives" },

      // Space / Earth observation / comms (dual-use risk varies)
      { name:"Rocket Lab", ticker:"RKLB", exchange:"NASDAQ", shares:4, ethics:5, home:"https://www.rocketlabusa.com", ceo:"Peter Beck",
        headline:"Rocket Lab wins contracts and expands space systems footprint" },

      { name:"Planet Labs", ticker:"PL", exchange:"NYSE", shares:11, ethics:7, home:"https://www.planet.com", ceo:"Will Marshall",
        headline:"Planet Labs expands partnerships for Earth observation data" },

      { name:"BlackSky", ticker:"BKSY", exchange:"NYSE", shares:1, ethics:4, home:"https://www.blacksky.com", ceo:"Brian O'Toole",
        headline:"BlackSky highlights real-time geospatial intelligence capabilities" },

      { name:"Spire Global", ticker:"SPIR", exchange:"NYSE", shares:1, ethics:6, home:"https://spire.com", ceo:"Theresa Condor",
        headline:"Spire Global updates results amid weather and maritime data focus" },

      { name:"Viasat", ticker:"VSAT", exchange:"NASDAQ", shares:1, ethics:4, home:"https://www.viasat.com", ceo:"Mark Dankberg",
        headline:"Viasat discusses satellite broadband and government communications" },

      { name:"L3Harris Technologies", ticker:"LHX", exchange:"NYSE", shares:1, ethics:2, home:"https://www.l3harris.com", ceo:"Chris Kubasik",
        headline:"L3Harris wins defense contract for space and sensing systems" },
    ];

    /**
     * ===========================
     *  QUOTE FETCHING
     * ===========================
     * We fetch “latest quote” via Stooq’s CSV endpoint:
     *   https://stooq.com/q/l/?s=AAPL.US&f=sd2t2ohlcv&h&e=csv
     *
     * Browser CORS often blocks direct calls to Stooq; therefore we use a text proxy:
     *   https://r.jina.ai/http://stooq.com/q/l/?s=AAPL.US&f=sd2t2ohlcv&h&e=csv
     *
     * Stooq symbol format:
     *   - US listed tickers often work as: <ticker>.us (lowercase ok)
     *   - Some OTC/ADR tickers may or may not be available; we handle failures gracefully.
     */

    function stooqSymbolFor(ticker){
      // Stooq typically expects lowercase with ".us"
      return `${ticker.toLowerCase()}.us`;
    }

    async function fetchLastPriceUSD(ticker){
      const sym = stooqSymbolFor(ticker);

      // Stooq quote CSV (one data row), proxied through r.jina.ai to avoid CORS blocks.
      const url = `https://r.jina.ai/http://stooq.com/q/l/?s=${encodeURIComponent(sym)}&f=sd2t2ohlcv&h&e=csv`;

      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error(`HTTP ${res.status}`);

      const text = (await res.text()).trim();

      // Expected CSV (header + one row):
      // Symbol,Date,Time,Open,High,Low,Close,Volume
      // AAPL.US,2026-01-02,22:00:16,272.255,277.840,269.000,271.010,37838054
      const lines = text.split("\n").map(l => l.trim()).filter(Boolean);
      if(lines.length < 2) throw new Error("No data rows");

      const header = lines[0].split(",").map(s => s.trim());
      const row = lines[1].split(",").map(s => s.trim());

      const closeIdx = header.findIndex(h => h.toLowerCase() === "close");
      if(closeIdx === -1) throw new Error("No close column");

      const close = Number(row[closeIdx]);
      if(!Number.isFinite(close)) throw new Error("Close not numeric");

      return close; // USD close as number
    }

    /**
     * ===========================
     *  LINK HELPERS
     * ===========================
     * - Company name → homepage already in data
     * - Ticker → Google Finance
     * - CEO → Google search
     * - Headline → Google News search
     */
    function googleFinanceLink(ticker, exchange){
      // Example: https://www.google.com/finance/quote/ETN:NYSE
      // OTC examples often work as :OTCMKTS
      return `https://www.google.com/finance/quote/${encodeURIComponent(ticker)}:${encodeURIComponent(exchange)}`;
    }

    function googleSearchLink(query){
      return `https://www.google.com/search?q=${encodeURIComponent(query)}`;
    }

    function googleNewsSearchLink(query){
      return `https://news.google.com/search?q=${encodeURIComponent(query)}`;
    }

    /**
     * ===========================
     *  RENDERING
     * ===========================
     */
    const rowsEl = document.getElementById("rows");
    const totalValueEl = document.getElementById("totalValue");
    const pricedCountEl = document.getElementById("pricedCount");
    const lastUpdatedEl = document.getElementById("lastUpdated");
    const refreshBtn = document.getElementById("refreshBtn");

    function fmtUSD(n){
      if(!Number.isFinite(n)) return "N/A";
      return n.toLocaleString(undefined, { style:"currency", currency:"USD" });
    }

    function ethicsBadge(score){
      // Simple banding to provide a quick moral signal
      if(score >= 8) return `<span class="badge b-ok">ethics ${score}/10</span>`;
      if(score >= 5) return `<span class="badge b-warn">ethics ${score}/10</span>`;
      return `<span class="badge b-bad">ethics ${score}/10</span>`;
    }

    function statusBadge(status){
      if(status === "OK") return `<span class="badge b-ok">priced</span>`;
      if(status === "N/A") return `<span class="badge b-bad">no quote</span>`;
      return `<span class="badge b-warn">loading</span>`;
    }

    function renderRow(item, price, value, status){
      const companyLink = `<a href="${item.home}" target="_blank" rel="noopener">${item.name}</a>`;
      const tickerLink = `<a href="${googleFinanceLink(item.ticker, item.exchange)}" target="_blank" rel="noopener" class="mono">${item.ticker}</a>`;
      const ceoLink = `<a href="${googleSearchLink(item.ceo)}" target="_blank" rel="noopener">${item.ceo}</a>`;
      const headlineLink = `<a href="${googleNewsSearchLink(item.name + " " + item.headline)}" target="_blank" rel="noopener">${item.headline}</a>`;

      // Desktop table layout; mobile uses data-label attributes
      return `
        <tr>
          <td data-label="Company">${companyLink}<div class="muted mono" style="margin-top:4px;">${ethicsBadge(item.ethics)}</div></td>
          <td data-label="Ticker">${tickerLink}</td>
          <td data-label="Shares" class="right mono">${item.shares}</td>
          <td data-label="Price" class="right mono">${fmtUSD(price)}</td>
          <td data-label="Position Value" class="right mono">${fmtUSD(value)}</td>
          <td data-label="Ethics" class="right mono">${item.ethics}/10</td>
          <td data-label="CEO">${ceoLink}</td>
          <td data-label="Headline">${headlineLink}</td>
          <td data-label="Status">${statusBadge(status)}</td>
        </tr>
      `;
    }

    async function refreshPortfolio(){
      refreshBtn.disabled = true;
      refreshBtn.textContent = "Refreshing…";

      // First pass: render placeholder rows
      rowsEl.innerHTML = PORTFOLIO.map(p => renderRow(p, NaN, NaN, "LOADING")).join("");

      let total = 0;
      let priced = 0;

      // Fetch all prices concurrently, but keep the UI stable
      const results = await Promise.allSettled(
        PORTFOLIO.map(async (p) => {
          const price = await fetchLastPriceUSD(p.ticker);
          const value = price * p.shares;
          return { ticker: p.ticker, price, value };
        })
      );

      // Build a map from ticker -> data, and compute totals
      const map = new Map();
      results.forEach((r, i) => {
        const p = PORTFOLIO[i];
        if(r.status === "fulfilled"){
          map.set(p.ticker, { ...r.value, status:"OK" });
          total += r.value.value;
          priced += 1;
        } else {
          map.set(p.ticker, { price: NaN, value: NaN, status:"N/A" });
        }
      });

      // Second pass: render final rows with data
      rowsEl.innerHTML = PORTFOLIO.map(p => {
        const d = map.get(p.ticker);
        return renderRow(p, d.price, d.value, d.status);
      }).join("");

      // Update KPI header
      totalValueEl.textContent = fmtUSD(total);
      pricedCountEl.textContent = `${priced} / ${PORTFOLIO.length}`;

      const now = new Date();
      lastUpdatedEl.textContent = `Last updated: ${now.toLocaleString()}`;

      refreshBtn.disabled = false;
      refreshBtn.textContent = "Refresh Prices";
    }

    // Wire up refresh button
    refreshBtn.addEventListener("click", refreshPortfolio);

    // Auto-run on first load
    refreshPortfolio();
  </script>
</body>
</html>
